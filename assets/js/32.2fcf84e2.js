(window.webpackJsonp=window.webpackJsonp||[]).push([[32],{353:function(s,a,n){"use strict";n.r(a);var e=n(7),t=Object(e.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("div",{staticClass:"custom-block note"},[a("p",{staticClass:"custom-block-title"},[s._v("笔记")]),s._v(" "),a("p",[s._v("2024-06-01，数据，代码给的太全面了，真的想看一看呐！")])]),s._v(" "),a("p",[s._v("话不多说，咱先看一下这篇文章的 "),a("code",[s._v("Code availability")])]),s._v(" "),a("h2",{attrs:{id:"code-availability"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#code-availability"}},[s._v("#")]),s._v(" Code availability")]),s._v(" "),a("p",[s._v("Source codes used in the study are accessible via the tab ‘CODES & INSTRUCTIONS’ on our website ("),a("a",{attrs:{href:"http://www.genetictargets.com/PDAC2",target:"_blank",rel:"noopener noreferrer"}},[s._v("http://www.genetictargets.com/PDAC2"),a("OutboundLink")],1),s._v("), where users can follow detailed step-by-step instructions ("),a("a",{attrs:{href:"http://www.genetictargets.com/PDAC2BOOKLET/index.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("http://www.genetictargets.com/PDAC2BOOKLET/index.html"),a("OutboundLink")],1),s._v(") to reproduce all results, including figures and tables, presented in the paper. Codes were also deposited into a public data repository at Figshare ("),a("a",{attrs:{href:"https://doi.org/10.6084/m9.figshare.24863049",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://doi.org/10.6084/m9.figshare.24863049"),a("OutboundLink")],1),s._v("). Our commitment to transparency in code and data sharing promotes reproducible research, allowing the broader clinical and research community to fully benefit from our work without any barriers.")]),s._v(" "),a("p",[a("strong",[s._v("Prospective observational study on biomarkers of response in pancreatic ductal adenocarcinoma")])]),s._v(" "),a("p",[s._v("nature medicine，IF：80+")]),s._v(" "),a("p",[s._v("胰腺导管腺癌，反应性生物标志物的，前瞻性观察研究")]),s._v(" "),a("h2",{attrs:{id:"abstract"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#abstract"}},[s._v("#")]),s._v(" Abstract")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("新辅助化疗")]),s._v(" 能使切除胰腺导管腺癌的患者受益，但是术后患者的身体状态受损会影响患者的依从性。需要生物标志物来确定及时辅助治疗的候选者。")]),s._v(" "),a("li",[s._v("在这项前瞻性观察研究中，纳入了1171例接受胰腺切除术的PDAC患者，并进行了全面的随访。")]),s._v(" "),a("li",[s._v("191例患者样本的蛋白质组学分析揭示了临床相关的功能蛋白模块。针对PDAC建立了蛋白质组学水平的预后风险模型，并使用公开的外部队列进一步验证了其实用性。\n"),a("ul",[a("li",[s._v("更重要的是，通过利用"),a("code",[s._v("临床")]),s._v(" 和 "),a("code",[s._v("蛋白质组学")]),s._v(" 数据集的"),a("code",[s._v("交互效应回归分析 / interaction effect regression analysis")]),s._v("，我们发现了两个生物标志物( NDUFB8和CEMIP2)，表明PDAC患者对辅助化疗的总体敏感性。通过对386例患者的内部队列进行免疫组化验证生物标志物。严格的验证扩展到两个外部多中心队列 -- 一个法国多中心队列( 230例患者)和一个来自中国两所三级甲等医院的队列( 466例患者)，增强了研究结果的稳健性和可推广性。")]),s._v(" "),a("li",[s._v("此外，通过功能实验在PDAC细胞系和患者来源的类器官上进行了实验验证。")])])]),s._v(" "),a("li",[s._v("总之，我们的队列规模整合了临床和蛋白质组学数据，证明了蛋白质组学指导PDAC预后和生物标志物辅助辅助化疗的潜力。")])]),s._v(" "),a("p",[s._v("读这篇文章，这么几个想要了解和学习的问题：")]),s._v(" "),a("ul",[a("li",[s._v("蛋白质组，一般是如何分析的？")]),s._v(" "),a("li",[s._v("最重要的！这个 "),a("code",[s._v("临床和蛋白质组学数据集的交互效应回归分析 / interaction effect regression analysis")]),s._v("，是怎么联系到一起分析的？")]),s._v(" "),a("li",[s._v("逐步 "),a("code",[s._v("缩小研究范围")]),s._v(" 的方法是哪些？")]),s._v(" "),a("li",[s._v("确定自己的研究内容"),a("code",[s._v("有用")]),s._v("，有哪些指标，分别是怎么验证的？")])]),s._v(" "),a("p",[s._v("治疗方案越来越多，所以个性化治疗也就越来越重要")]),s._v(" "),a("blockquote",[a("p",[s._v("With a growing array of regimens available, stratifying patients to identify the best responders for the most effective therapeutic strategies is critical to improve personalized oncology care.")])]),s._v(" "),a("h2",{attrs:{id:"r1-pdac患者"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#r1-pdac患者"}},[s._v("#")]),s._v(" R1，PDAC患者")]),s._v(" "),a("p",[s._v("PDAC患者 → 前瞻性观察性研究 → 最佳的分层策略，"),a("code",[s._v("RJ-cohort")]),s._v("（队列研究，真的是一件，功在当下，利在千秋的事情）")]),s._v(" "),a("blockquote",[a("p",[s._v("To elucidate the optimal stratification strategy for patients with PDAC, we conducted a prospective observational study on a Chinese cohort of 1,171 patients with PDAC who were diagnosed and treated by pancreatectomy at Ruijin Hospital, resulting in an entire in-house cohort denoted as ‘RJ-cohort’")])]),s._v(" "),a("p",[s._v("大的队列"),a("code",[s._v("RJ-cohort")]),s._v("，其中进行了蛋白质组学分析的队列叫"),a("code",[s._v("RJ-cohort1")]),s._v("，在多项人口统计学和临床病理信息上，没有统计学差异（demographic，clinicopathological information）")]),s._v(" "),a("p",[s._v("有一个实验设计的模式图：\n"),a("img",{attrs:{src:"https://s2.loli.net/2024/06/01/vNbg4sGOJEQlxB2.png",alt:"image.png|800"}})]),s._v(" "),a("p",[s._v("191 treatment-naive tumors and 90 paired "),a("code",[s._v("tumor adjacent tissues (TATs)")]),s._v(" for an in-depth proteomic analysis")]),s._v(" "),a("p",[s._v("H&E staining on all 191 samples before global proteomic analyses")]),s._v(" "),a("ul",[a("li",[s._v("Principal component analyses (PCAs)：a clear separation（Tumor & TATs）")]),s._v(" "),a("li",[s._v("Volcano plot：significantly upregulated & downregulated proteins (Tumor VS TATs)")]),s._v(" "),a("li",[s._v("Pathway enrichment analysis\n"),a("img",{attrs:{src:"https://s2.loli.net/2024/06/01/b6IOXUagGKZw24L.png",alt:"image.png|600"}})])]),s._v(" "),a("p",[s._v("Oncogenic signaling pathways, complement and coagulation cascades and ECMreceptor interactions were active in tumors."),a("br"),s._v("\nConversely, metabolic pathways, oxidative phosphorylation and ribosome exhibited significant downregulation in tumor samples.")]),s._v(" "),a("h2",{attrs:{id:"r2-临床相关功能蛋白模块"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#r2-临床相关功能蛋白模块"}},[s._v("#")]),s._v(" R2，临床相关功能蛋白模块")]),s._v(" "),a("p",[s._v("Clinically relevant functional protein modules")]),s._v(" "),a("p",[s._v("weighted correlation network analysis，WGCNA，加权相关网络分析 → 32 "),a("code",[s._v("functional modules")]),s._v("(??)")]),s._v(" "),a("p",[s._v("得到了这么个蛮炫酷的图（ps：我之前做过的一个WGCNA分析结果咋不是这样的呢，感觉比这个丑多了）\n"),a("img",{attrs:{src:"https://s2.loli.net/2024/06/01/HeRo5bvYxB2IjpX.png",alt:"image.png|400"}})]),s._v(" "),a("ul",[a("li",[s._v("a, WGCNA identified 32 functional protein modules (ME01–32) enriched in proteomic data for tumor samples. Each network node represents one protein, color-coded by the different functional modules.")]),s._v(" "),a("li",[s._v("b, Overlay of significantly upregulated/downregulated proteins between tumors and TATs onto the network nodes.")])]),s._v(" "),a("p",[s._v("得到的"),a("code",[s._v("module")]),s._v("是啥呀？\n"),a("code",[s._v("Robustness analysis")]),s._v(" confirmed the "),a("code",[s._v("stability")]),s._v(" of these protein modules -- 不懂这俩词的含义")]),s._v(" "),a("p",[s._v("下面这俩图不懂！！")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://s2.loli.net/2024/06/01/yCvJetqxmUG7sd8.png",alt:"image.png|700"}})]),s._v(" "),a("ul",[a("li",[s._v("(a) Determination of soft-threshold power in WGCNA. Analysis of the scale-free index for various soft-threshold powers (β) and the mean connectivity for various soft-threshold powers.")]),s._v(" "),a("li",[s._v("(b) Dendrogram of proteins based on the measurement of dissimilarity and identification of the 32 modules.")])]),s._v(" "),a("p",[s._v("下面这三个图，也不懂呢！！！")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://s2.loli.net/2024/06/01/q96QkWsKeVJZrDh.png",alt:"image.png|800"}})]),s._v(" "),a("ul",[a("li",[s._v("(c) Evaluating the stability of the 32 protein modules. For each calculation process, 80% of PDAC tumors were randomly selected for the identification of protein modules, employing a sample construction workflow and determining the soft-threshold power for the initial 32 protein modules.\n"),a("ul",[a("li",[s._v("Taking ME01 as an example, the accuracy for ME01 was calculated using the formula [Number of proteins clustered in ME01] / [Total protein number of ME01]. This calculation process was repeated 20 times (n=20 biologically independent calculations) with different random seed, consistently yielding median accuracies exceeding 90%. This underscores the robustness and stability for module identification. In the boxplot, a black line within the box marks the median. The bottom and top of the box are located at the 25th and 75th percentiles, respectively. The bars represent values that are more than 1.5 times the interquartile range from the border of each box.")])])]),s._v(" "),a("li",[s._v("(d) Receiver operating characteristic (ROC) curves, illustrating the prediction accuracy of the 32 protein modules in ‘RJ-cohort 1’. A random forest algorithm was employed to build the model, with 80% PDACs used as the training cohort and the remaining 20% as the validation cohort. Area under curve (AUC) values were calculated for each module separately.")]),s._v(" "),a("li",[s._v("(e) ROC curves depicting the prediction accuracy of the 32 modules in Cao et al cohort. The model was constructed based on ‘RJ-cohort 1’, and the Cao et al. cohort was used as the validation cohort. (f) Validation of overlay of the significantly up/down-regulated proteins (left) and genes (right) between tumors and TATs on the weighted correlation network nodes from the Cao et al cohort.")])]),s._v(" "),a("p",[s._v("module （包括几十个基因），这种数据是如何区分，然后做的生存分析？\n"),a("img",{attrs:{src:"https://s21.ax1x.com/2024/06/02/pkGGNOx.png",alt:"pkGGNOx.png|400"}})]),s._v(" "),a("h2",{attrs:{id:"r3-预后风险模型"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#r3-预后风险模型"}},[s._v("#")]),s._v(" R3，预后风险模型")]),s._v(" "),a("p",[s._v("A proteomics-level prognostic risk model for PDAC")]),s._v(" "),a("p",[s._v("拿蛋白质进行生存分析，预后的预测了")]),s._v(" "),a("p",[s._v("least absolute shrinkage and selection operator (LASSO) – Cox regression analysis")]),s._v(" "),a("p",[s._v("还根据"),a("code",[s._v("LASSO scores")]),s._v("，将患者分成低分和高分组，然后能预测预后情况 -- P，HR，CI，AUC，→ an independent prognostic predictor for OS")]),s._v(" "),a("p",[s._v("multivariable analysis，多因素分析")]),s._v(" "),a("p",[s._v("在别的模型中去预测，判断是一致的，是有用的")]),s._v(" "),a("p",[s._v("parallel reaction monitoring (PRM)，平行反应监测 -- a method for targeted proteomic analysis")]),s._v(" "),a("p",[s._v("这一步，应该是把几千个蛋白质信息，缩小到了14个modules")]),s._v(" "),a("h2",{attrs:{id:"r4-反应生物指标"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#r4-反应生物指标"}},[s._v("#")]),s._v(" R4，反应生物指标")]),s._v(" "),a("p",[s._v("Proteomic biomarkers of response in PDAC")]),s._v(" "),a("p",[s._v("Cox proportional hazards models")]),s._v(" "),a("p",[s._v("肿瘤中低表达 / 越低化疗越好"),a("br"),s._v("\nNDUFB8, a mitochondrial respiratory chain complex I protein crucial for oxidative energy metabolism（线粒体呼吸链，氧化能量代谢）")]),s._v(" "),a("p",[s._v("肿瘤中高表达 / 越高化疗越好"),a("br"),s._v("\nCEMIP2, encoding a cell surface hyaluronidase responsible for breaking down high-molecular-weight hyaluronan into low-molecular-weight hyaluronan（hyaluronidase，透明质酸酶；hyaluronan，透明质酸）")]),s._v(" "),a("h2",{attrs:{id:"r5-外部和内部的验证"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#r5-外部和内部的验证"}},[s._v("#")]),s._v(" R5，外部和内部的验证")]),s._v(" "),a("p",[s._v("External and internal validation of two biomarkers in PDAC")]),s._v(" "),a("p",[s._v("ad hoc，adj.临时安排的；特别的；专门的")]),s._v(" "),a("p",[s._v("RJ-cohort 1，RJ-cohort 3，SH-cohort，FR-cohort")]),s._v(" "),a("p",[s._v("好多个HR，CI，P值....")]),s._v(" "),a("p",[s._v("没学好流行病学，也没学好统计学，理解，但是不知道在这里是怎么算的...")]),s._v(" "),a("h2",{attrs:{id:"discussion"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#discussion"}},[s._v("#")]),s._v(" Discussion")]),s._v(" "),a("p",[s._v("在过去的几十年中，基因组和转录组数据的整合分析揭示了PDAC的分子格局，包括确定关键的基因改变(如KRAS、TP53、CDKN2A、SMAD4等)和基于表达的分子亚型。")]),s._v(" "),a("p",[s._v("尽管这些分析大大拓宽了对这种恶性肿瘤的分子基础的认识，但对该疾病的完整理解需要整合全面的蛋白质组学数据。")]),s._v(" "),a("p",[s._v("蛋白质组学可以为PDAC的临床、生物学和治疗方面提供新的见解，以更直接的方式弥合基因型和表型之间的差距。在之前的研究中，Cao等人整合了多组学数据来研究基因组和表观基因组扰动对基因和蛋白表达的影响。")]),s._v(" "),a("p",[s._v("在此基础上，我们的研究涉及了191个未经治疗的肿瘤和90个配对的TATs的蛋白质组学分析，这些分析来自于在中国( ' RJ-cohort 1 ')进行的大规模、前瞻性、观察性研究。我们的研究结果，基于我们的内部队列和外部队列，为PDAC的临床、生物学和治疗的理解提供了见解。")]),s._v(" "),a("p",[s._v("精准医疗！！！")]),s._v(" "),a("p",[s._v("RNAseq，预测新辅助化疗的敏感性")]),s._v(" "),a("ul",[a("li",[s._v("A transcriptomic signature to predict adjuvant gemcitabine sensitivity in pancreatic adenocarcinoma")])]),s._v(" "),a("p",[s._v("嗯，文章还蛮短的，结论不多，但是看着觉得用处还蛮大的，挺有用的。分析的方式不熟悉，但是有感觉不是太难，主要是数据比较难获取吧，随访了那么久，又做那么多蛋白质组学，肯定很花钱,,,")]),s._v(" "),a("h2",{attrs:{id:"methods-figures"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#methods-figures"}},[s._v("#")]),s._v(" Methods & Figures")]),s._v(" "),a("p",[s._v("文章给的代码这么齐全，怎么不好好利用一下子呢？")]),s._v(" "),a("p",[a("a",{attrs:{href:"http://www.genetictargets.com/PDAC2BOOKLET/index.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("PDAC2BOOKLET (genetictargets.com)"),a("OutboundLink")],1)]),s._v(" "),a("h3",{attrs:{id:"figure-1"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#figure-1"}},[s._v("#")]),s._v(" Figure 1")]),s._v(" "),a("p",[s._v("Volcano plot，limma package，adjust P value - Benjamini & Hochberg (BH) method，| log2FC | ＞0.58（ | FC |＞1.5）")]),s._v(" "),a("p",[s._v("3D PCA")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('library(scatterplot3d)\nlibrary(tidyverse)\nlibrary(openxlsx)\nlibrary(factoextra) # Extract and Visualize the Results of Multivariate Data Analyses\ncolor.bin <- c("#00599F","#D01910")\ndir.create("./results/Figure1",recursive = T)\n\n#  Step 1: Load Proteomics data\npro  <- readRDS("./data/proteomics/20230412_PDAC_PRO_exp.rds") # 4787 protein * 281 samples（4787行蛋白，281列样本）\nmeta <- readRDS("./data/proteomics/20230412_PDAC_PRO_meta.rds") \nidentical(rownames(meta),colnames(pro)) # check names  # identical() 是否相同？\n\n#  Step 2: PCA\nres.pca.comp <- prcomp(pro, scale = F)\n\n#  Step 3: Plot\nplot.data <- as.data.frame(res.pca.comp$rotation[, 1:10])\nplot.data <- plot.data %>% \n              mutate(ID = rownames(plot.data),\n                     Type = meta$Type,\n                     TypeColor = color.bin[as.numeric(as.factor(Type))])\npdf("./results/Figure1/1B.PRO_PCA3d.pdf", width = 7, height = 7)\nscatterplot3d(x = plot.data$PC2, \n              y = plot.data$PC1, \n              z = plot.data$PC3,\n              color = plot.data$TypeColor,\n              pch = 16, cex.symbols = 1, # 点的类型和大小\n              scale.y = 0.7, angle = 45, # 有轴的比例和角度\n              xlab = "PC2", ylab = "PC1", zlab = "PC3",\n              main="3D Scatter Plot of proteomics",\n              col.axis = "#444444", col.grid = "#CCCCCC" # 坐标轴和网格的颜色\n              )\nlegend("bottom", legend = levels(as.factor(meta$Type)),\n      col =  color.bin,  pch = 16,\n      inset = -0.15, xpd = TRUE, horiz = TRUE)\ndev.off()\nwrite.xlsx(plot.data, "./results/Figure1/1B.PRO_PCA3d.xlsx", overwrite = T)\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br")])]),a("p",[s._v("identical，完全相同的，极为相似的")]),s._v(" "),a("p",[s._v("tidyverse\n"),a("img",{attrs:{src:"https://s2.loli.net/2024/06/02/7hp8CiGLuZ2fyN5.png",alt:"image.png|400"}})]),s._v(" "),a("p",[s._v("library(tidyverse)\ntidyverse_packages()")]),s._v(" "),a("p",[a("a",{attrs:{href:"https://www.tidyverse.org/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Tidyverse 官网"),a("OutboundLink")],1)]),s._v(" "),a("p",[a("a",{attrs:{href:"https://cloud.tencent.com/developer/article/1886955",target:"_blank",rel:"noopener noreferrer"}},[s._v("tidyverse"),a("OutboundLink")],1)]),s._v(" "),a("ul",[a("li",[s._v("readr：read_，write_")]),s._v(" "),a("li",[s._v("tidyr / 整理：gather，spread，seperate，unite，")]),s._v(" "),a("li",[s._v("dplyr / 操作：filter，select，arrange，mutate，summarise，slice，rename，relocate，")]),s._v(" "),a("li",[s._v("purr：map，map2，pmap，")])]),s._v(" "),a("p",[a("a",{attrs:{href:"https://lizongzhang.github.io/stat/5dplyr.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("dplyr"),a("OutboundLink")],1)]),s._v(" "),a("ul",[a("li",[s._v("columns：select，rename，mutate，relocate")]),s._v(" "),a("li",[s._v("rows：filter，slice，arrange")]),s._v(" "),a("li",[s._v("groups：summarise，count，top_n")])]),s._v(" "),a("p",[s._v("R 语言教程")]),s._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://bookdown.org/wangminjie/R4DS/",target:"_blank",rel:"noopener noreferrer"}},[s._v("前言 | 数据科学中的 R 语言 (bookdown.org)"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://shalom-lab.github.io/r-book/",target:"_blank",rel:"noopener noreferrer"}},[s._v("R语言入门指南 (shalom-lab.github.io)"),a("OutboundLink")],1)])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('p <- fviz_eig(res.pca.comp) # variance percent of each PC\nvar_explained <- get_eig(res.pca.comp)\n\n# var_explained <- res.pca.comp$sdev^2 / sum(res.pca.comp$sdev^2)\nggsave("./results/Figure1/1B.PRO_PCA_percent.pdf",p,width = 5, height = 5)\nwrite.xlsx(var_explained, "./results/Figure1/1B.PRO_PCA_percant.xlsx",rowNames=T, overwrite = T)\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('library(limma)\nlibrary(tidyverse)\nlibrary(openxlsx)\nlibrary(ggpubr)\nlibrary(ggthemes)\n\n\n#  Step 1: Load Proteomics data\nexp  <- readRDS("./data/proteomics/20230412_PDAC_PRO_exp.rds") # 4787 protein * 281 samples\nmeta <- readRDS("./data/proteomics/20230412_PDAC_PRO_meta.rds")\nidentical(rownames(meta),colnames(exp)) # check names\n\n\n#  Step 2: limma\nmeta      <- meta %>% mutate(contrast=as.factor(Type)) \ndesign    <- model.matrix(~ 0 + contrast , data = meta) # un-paired\nfit       <- lmFit(exp, design)\ncontrast  <- makeContrasts( Tumor_Normal = contrastT - contrastN , levels = design)\nfits      <- contrasts.fit(fit, contrast)\nebFit     <- eBayes(fits)\nlimma.res <- topTable(ebFit, coef = "Tumor_Normal", adjust.method = \'fdr\', number = Inf)\n## result\nlimma.res <- limma.res %>% filter(!is.na(adj.P.Val)) %>% \n              mutate( logP = -log10(adj.P.Val) ) %>%\n              mutate( tag = "Tumor -vs- Normal")%>%\n              mutate( Gene = ID)\n# cutoff:  FC:1.5   adj.p:0.05\nlimma.res <- limma.res %>% mutate(group=case_when(\n                                  (adj.P.Val < 0.05 & logFC > 0.58) ~ "up",\n                                  (adj.P.Val < 0.05 & logFC < -0.58) ~ "down",\n                                  .default = "not sig"))\ntable(limma.res$group) # UP:1213 ; DOWN:864 ; not:2710\n## output\nwrite.xlsx( limma.res, "./results/Figure1/1C.PRO_Limma_fc1.5.xlsx", overwrite = T, rowNames = F) \n\n\n#  Step 3: Vasualization \n## volcano\nlimma.res <- limma.res %>% mutate(group=factor(group,levels = c("up","down","not sig")))\nmy_label <- paste0( "FC:1.5 ; AdjP:0.05 ; ",\n                    "Up:",table(limma.res$group)[1]," ; ",\n                    "Down:",table(limma.res$group)[2])\np <- ggscatter(limma.res,\n               x = "logFC", y = "logP",\n               color = "group", size = 2,\n               main = paste0("Tumor -vs- TAC"), # ***\n               xlab = "log2FoldChange", ylab = "-log10(adjusted P.value)",\n               palette = c("#D01910","#00599F","#CCCCCC"),\n               ylim = c(-1, 70),xlim=c(-8,8))+\n  theme_base()+\n  geom_hline(yintercept = -log10(0.05), linetype="dashed", color = "#222222") +\n  geom_vline(xintercept = 0.58 , linetype="dashed", color = "#222222") +\n  geom_vline(xintercept = -0.58, linetype="dashed", color = "#222222") +\n  labs(subtitle = my_label)+\n  theme(plot.background = element_blank())\nggsave("./results/Figure1/1C.PRO_Limma_fc1.5.pdf", p, width = 10, height = 10)\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br")])]),a("p",[a("code",[s._v("mutate")]),s._v("，"),a("code",[s._v("case_when")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('limma.res <- limma.res %>% mutate(group = case_when(\n                                  (adj.P.Val < 0.05 & logFC > 0.58) ~ "up",\n                                  (adj.P.Val < 0.05 & logFC < -0.58) ~ "down",\n                                  .default = "not sig")\n                                  )\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('# data : enriched pathways table\nplot.data <- read.xlsx("./data/Extended Data Table 3.xlsx", sheet = 2, startRow = 2)\nplot.pathway <- c("GO:0006730~one-carbon metabolic process","GO:0006888~ER to Golgi vesicle-mediated transport","hsa00020:Citrate cycle (TCA cycle)","hsa00071:Fatty acid degradation","hsa00190:Oxidative phosphorylation","hsa00250:Alanine, aspartate and glutamate metabolism","hsa00260:Glycine, serine and threonine metabolism","hsa00280:Valine, leucine and isoleucine degradation","hsa00480:Glutathione metabolism","hsa00520:Amino sugar and nucleotide sugar metabolism","hsa00620:Pyruvate metabolism","hsa00630:Glyoxylate and dicarboxylate metabolism","hsa00640:Propanoate metabolism","hsa01100:Metabolic pathways","hsa01200:Carbon metabolism","hsa01212:Fatty acid metabolism","hsa01240:Biosynthesis of cofactors","hsa03010:Ribosome","hsa03060:Protein export","hsa04141:Protein processing in endoplasmic reticulum","hsa04972:Pancreatic secretion","GO:0001916~positive regulation of T cell mediated cytotoxicity","GO:0006096~glycolytic process","GO:0007165~signal transduction","GO:0007266~Rho protein signal transduction","GO:0045087~innate immune response","GO:0050778~positive regulation of immune response","GO:0050853~B cell receptor signaling pathway","GO:0050870~positive regulation of T cell activation","GO:0071346~cellular response to interferon-gamma","hsa04015:Rap1 signaling pathway","hsa04062:Chemokine signaling pathway","hsa04066:HIF-1 signaling pathway","hsa04151:PI3K-Akt signaling pathway","hsa04512:ECM-receptor interaction","hsa04610:Complement and coagulation cascades","hsa04621:NOD-like receptor signaling pathway","hsa04666:Fc gamma R-mediated phagocytosis")\n\nplot.data <- plot.data %>% filter(Term %in% plot.pathway) %>% \n                    mutate(LogFDR= -log10(FDR))\n# plot\ncolor.bin <- c("#00599F","#D01910")\np <- ggscatter(plot.data, \n\t\t\t   x = "LogFDR", y = "Fold.Enrichment", color = "Type",\n               main = "Enrichment of tumor/TAC protein",\n               size = "Ratio", shape = 16,\n               label = plot.data$Term, palette = color.bin) + theme_base()\np <- p + scale_size(range = c(4,20)) + \n         scale_x_continuous(limit = c(-10, 40)) + \n         theme(plot.background = element_blank())\nggsave(paste0("./results/Figure1/1D.PRO_deg.tn_enrich.pdf"), p, width = 11, height = 10)\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br")])]),a("h3",{attrs:{id:"figure-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#figure-2"}},[s._v("#")]),s._v(" Figure 2")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('library(WGCNA)\ndir.create("./results/Figure2/WGCNA",recursive = T)\n\n\n#  Step 1: Loading expression data and set parameters\nprotein.nona.tumor <- readRDS("./data/proteomics/wgcna/20230412_PDAC_PRO_Tumor_exp.rds")\ncorType = "pearson"\ncorFnc = ifelse(corType=="spearman", cor, bicor)\nmaxPOutliers = ifelse(corType=="pearson",1, 0.05)\n\nplot.mat <- t(protein.nona.tumor - rowMeans(protein.nona.tumor)) # row: samples | col: genes # input data normalization\n\n\n#  Step 2: identification of outlier samples\nsampleTree = hclust(dist(plot.mat), method = "ward.D")\npdf(paste0("./results/Figure2/WGCNA/1.tree.pdf"), width = 20, height = 9)\nplot(sampleTree, main = "Sample clustering to detect outliers", sub="", xlab="")\ndev.off()\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br")])]),a("p",[a("code",[s._v('dir.create("./results/Figure2/WGCNA",recursive = T)')]),s._v("，")]),s._v(" "),a("ul",[a("li",[s._v("recursive，回归的，递归的")]),s._v(" "),a("li",[s._v("默认FALSE，父目录存在时才创建，TRUE，父目录不存在才会创建")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('#  Step 3: analysis of network topology\npowers = c(c(1:10), seq(from = 12, to = 30, by = 2)) # Choose a set of soft-thresholding powers\n\n# Call the network topology analysis function 调用网络拓扑分析函数\nsft = pickSoftThreshold(plot.mat, \n\t\t\t\t\t\tpowerVector = powers,  # 包含了用于测试的不同幂律参数值\n                        networkType="unsigned",  # 指定网络类型为无符号网络（不考虑基因表达正负）\n                        verbose=5,   # 日志记录级别参数，越高越详细\n                        )\n                        \npdf(paste0("./results/Figure2/WGCNA/2.power.pdf"), width = 12, height = 8)\npar(mfrow = c(1,2))\ncex1 = 0.9\n\nplot(sft$fitIndices[,1], -sign(sft$fitIndices[,3])*sft$fitIndices[,2],\n     xlab="Soft Threshold (power)",\n     ylab="Scale Free Topology Model Fit, signed R^2",type="n",\n     main = paste("Scale independence")\n     )\ntext(sft$fitIndices[,1], -sign(sft$fitIndices[,3])*sft$fitIndices[,2],\n     labels=powers,cex=cex1,col="red")\nabline(h=0.85,col="red")\n\nplot(sft$fitIndices[,1], sft$fitIndices[,5],\n     xlab="Soft Threshold (power)",\n     ylab="Mean Connectivity", type="n",\n     main = paste("Mean connectivity"))\ntext(sft$fitIndices[,1], sft$fitIndices[,5], labels=powers, \n     cex=cex1, col="red")\ndev.off()\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br")])]),a("ul",[a("li",[a("code",[s._v("?pickSoftThreshold")]),s._v(" 或 "),a("code",[s._v("help(pickSoftThreshold)")]),s._v("，查看"),a("code",[s._v("pickSoftThreshold")]),s._v("用法")]),s._v(" "),a("li",[s._v("该函数通过分析不同幂次下的网络拓扑属性来确定最佳幂次，确保网络具有理想的模块化特性")])]),s._v(" "),a("p",[a("img",{attrs:{src:"http://www.genetictargets.com/PDAC2BOOKLET/_main_files/figure-html/unnamed-chunk-16-1.png",alt:"scale independence + mean connectivity |500"}})]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('#  Step 4: soft threshold : power\npower = sft$powerEstimate\npower\n\n\n#  Step 5: One-step network construction and module detection\nnet = blockwiseModules(plot.mat,  # 一个相似性或距离矩阵，用于构建网络\n\t\t\t\t\t   power = power,  # 用于构建网络的幂次参数\n\t\t\t\t\t   maxBlockSize = ncol(plot.mat), # 在模块检测过程中使用的最大块大小\n                       TOMType = "signed",  # 拓扑重叠矩阵（TOM）的类型，signed，考虑正负相关性，unsigned，不考虑正负相关性\n                       minModuleSize = 20,  # 模块的最小大小\n                       reassignThreshold = 0,  # 重新分配基因到其他模块的阈值，这里设置为0，表示不进行重新分配\n                       mergeCutHeight = 0.0001,\n                       numericLabels = TRUE, \n                       pamRespectsDendro = FALSE,\n                       saveTOMs=TRUE, \n                       corType = corType, \n                       maxPOutliers = 1, \n                       loadTOMs=TRUE,\n                       randomSeed = 931, # seed\n                       saveTOMFileBase = paste0("./results/Figure2/WGCNA/WGCNA.tom"),\n                       verbose = 3, \n                       pearsonFallback = "none", \n                       deepSplit = 3 )\n# module:\ntable(net$colors) # 0 corresponds to unclassified genes\n\n# Convert [number] labels to [colors] for plotting\nmoduleLabels = net$colors\nmoduleColors = labels2colors(moduleLabels)\n\n# plot\npdf(paste0( "./results/Figure2/WGCNA/3.module.pdf"), width = 8, height = 6)\nplotDendroAndColors(net$dendrograms[[1]], moduleColors[net$blockGenes[[1]]],\n                    "Module colors",\n                    dendroLabels = FALSE, hang = 0.03,\n                    addGuide = TRUE, guideHang = 0.05)\ndev.off()\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br")])]),a("p",[a("img",{attrs:{src:"http://www.genetictargets.com/PDAC2BOOKLET/_main_files/figure-html/unnamed-chunk-18-1.png",alt:"cluster dendrogen|500"}})]),s._v(" "),a("p",[s._v("！！！很好看的那个圆球")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('#  Step 6: Vasualization\nnode.data <- readRDS("./data/proteomics/wgcna/2D-node.data.rds")\nedge.data <- readRDS("./data/proteomics/wgcna/2D-edge.data.rds")\n\ncolor.module <- c("#CCCCCC","#ecb888","#af88bb","#a032cb","#efbed6","#fc496a","#b6d37f","#589336","#7fd68e","#52c465","#3372e0","#84d7f6","#5394c3","#6376b3","#7f6cd7","#c4ceff","#fc9d40","#5c95e0","#cd7560","#ff70e4", "#ff8738", "#ffcead","#1cbf8b", "#b76d38", "#1584ff", "#7f006d", "#ffd35f","#E66F73","#F57F20","#1DBB95","#9CB79F","#F0B8D2","#A0485E","#A0688E","#C7E1DF","#51B1DF","#6D97D7","#5D6193","#CEC3E0","#A9917E","#7C7D80","#F4E192","#ADD666")\nnames(color.module) <- paste0("ME", seq(0,length(color.module)-1) %>% str_pad(width = 2,side = "left",pad = "0"))\n## plot network \n\ngg <- ggplot()\ngg <- gg + geom_segment(mapping = aes(x = from.x, y = from.y, xend = to.x, yend = to.y),\n                        color = "#CCCCCC", \n                        size = 0.01, \n                        data = edge.data\n                        ) # draw a straight line\ngg <- gg + geom_point(mapping = aes(x = pos.x, y = pos.y, color = Module), \n                      size = 2, data = node.data\n                      )  # add point\ngg <- gg + scale_size(range = c(0, 6) * 2) # specifies the minimum and maximum size \ngg <- gg + theme_void()\ngg <- gg + labs(x = "", y = "", title = paste0("PPI"))\ngg <- gg + scale_colour_manual(values = color.module)\nggsave(paste0("./results/Figure2/2A-PRO-modules.png"), gg, width = 10, height = 8)\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://s2.loli.net/2024/06/03/ZfIz8lvnt9sHaoW.png",alt:"image.png|600"}})]),s._v(" "),a("p",[s._v("显著差异基因（红蓝色块的蛋白分布圆球）")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('#  Overlay the log2 fold change between tumor and TAC on PRO in the WGCNA network\nnode.data <- readRDS("./data/proteomics/wgcna/2D-node.data.rds") # DEG & module genes\nedge.data <- readRDS("./data/proteomics/wgcna/2D-edge.data.rds")\n\n## plot\ngg <- ggplot()\ngg <- gg + geom_segment(mapping = aes(x = from.x, y = from.y, xend = to.x, yend = to.y),\n                        color = "#CCCCCC", size = 0.01, data = edge.data)\ngg <- gg + geom_point(mapping = aes(x = pos.x, y = pos.y, color = proSig), size = 1,\n                      data = node.data[which(node.data$proSig == "zz"), ])\ngg <- gg + geom_point(mapping = aes(x = pos.x, y = pos.y, color = proSig), size = 2.5,\n                      data = node.data[which(node.data$proSig != "zz"), ])\ngg <- gg + scale_size(range = c(0, 6) * 2)\ngg <- gg + theme_void()\ngg <- gg + labs(x = "", y = "", title = paste0("color by proSig"))\ngg <- gg + scale_colour_manual(values = c("#00599F","#D01910","#AAAAAA"))\nggsave(paste0("./results/Figure2/2B-proSig.png"), gg, width = 8.5, height = 8)\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://s2.loli.net/2024/06/03/o5RBLdaKl4Q8ib3.png",alt:"image.png|500"}})]),s._v(" "),a("p",[a("strong",[s._v("模块富集得分 / 上下条图")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('color.bin <- c("#00599F","#d80700")\n#----------------------------------------------------------------------------------\n#  Step 1: Load the RJ-cohort 1 Data\n#----------------------------------------------------------------------------------\n# Scores of the 32 modules in TACs and PDACs of RJ-cohort 1\nplot.data <- read.xlsx("./data/Extended Data Table 4.xlsx", sheet = 2, startRow = 2, rowNames = T)\n#                       ME01         ME02        ME03       ME04\n# RJ-01-0143-N_PRO 0.3474261 -0.114677437 -0.04291552 0.06708347\n# RJ-01-0768-N_PRO 0.2532539  0.009051615 -0.03585508 0.03486392\n# RJ-01-0697-N_PRO 0.2839048 -0.032966990 -0.02943711 0.05803330\n# RJ-01-0609-N_PRO 0.3206755 -0.087559353 -0.05749618 0.10310726\nplot.info <- NULL\nmodule.name <- colnames(plot.data)\nplot.stat <- data.frame(Module = module.name,\n                        Wilcox.P = NA,\n                        Wilcox.Padj = NA)\n#----------------------------------------------------------------------------------\n#  Step 2: wilcox.test\n#----------------------------------------------------------------------------------\nfor (i in 1:ncol(plot.data)) {\n  sub <- data.frame(Sample = rownames(plot.data),\n                    Score = as.numeric(plot.data[, i]), \n                    ScoreScale = scale(as.numeric(plot.data[, i])),\n                    Module = colnames(plot.data)[i],\n                    Type = substr(rownames(plot.data), 12, 16))\n  plot.stat$Wilcox.P[i] <- wilcox.test(sub$ScoreScale ~ sub$Type)$p.value\n  plot.info <- rbind(plot.info, sub)\n}\nplot.info <- plot.info %>% mutate(Type=factor(as.character(Type), levels = c("N_PRO","T_PRO"))) \nplot.stat <- plot.stat %>% mutate(Wilcox.Padj=p.adjust(Wilcox.P, method = "fdr"))\n#----------------------------------------------------------------------------------\n#  Step 3: plot\n#----------------------------------------------------------------------------------\np <- ggbarplot(plot.info, x = "Module", y = "ScoreScale",\n               color = "Type", fill = "Type",\n               palette = color.bin, width = 0.5, size = 0,\n               add = c("mean_se"), add.params = list(width = 0.5),\n               order = module.name,\n               position = position_dodge(0.6),\n               xlab = "", ylab = "Module Score of Protein")\np <- p + theme_base() \np <- p + geom_hline(yintercept = 0, color = "black")\np <- p + theme(axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.5))\np <- p + stat_compare_means(aes(group = Type, label = ..p.format..), size = 1, method = "wilcox.test", label.y = 1.2)  + theme(plot.background = element_blank())\n#----------------------------------------------------------------------------------\n#  Step 4: output\n#----------------------------------------------------------------------------------\nggsave(paste0("./results/Figure2/Figure2c-1.pdf"), p, width = 12, height = 4)\nwrite.xlsx(plot.stat, paste0("./results/Figure2/Figure2c.padj-1.xlsx"))\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://s2.loli.net/2024/06/03/qYIMrpDiofeUSzE.png",alt:"image.png|400"}})]),s._v(" "),a("ul",[a("li",[s._v('p.adjust(Wilcox.P, method = "fdr")')]),s._v(" "),a("li",[s._v("Wilcoxon 秩和检验（一种非参数检验方法，常用于比较两个独立样本的中位数差异）")]),s._v(" "),a("li",[s._v("用于对一组 P 值进行调整，以控制多重假设检验中的一类错误率（family-wise error rate）")]),s._v(" "),a("li",[s._v('"fdr" 指的是 Benjamini-Hochberg 程序的 false discovery rate（FDR）方法，FDR 方法旨在控制错误发现的比例，而不是控制单个检验的错误率')])]),s._v(" "),a("p",[a("strong",[s._v("Association")]),s._v(" of the enrichment score of the 32 modules with clinical data and RNA-seq subtype.")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('library(survival)\n#----------------------------------------------------------------------------------\n#  Step 1: Loading expression data and set parameters\n#----------------------------------------------------------------------------------\n# (1) Sample information and clinical characteristics of the 191 PDAC patients (the RJ-cohort 1)\nrj1.cohort <- read.xlsx("./data/Extended Data Table 2.xlsx", startRow = 2)\n#           ID     Proteomic_ID        RNAseq_ID Age Gender      BMI DM Smoking\n# 1 RJ-01-0020 RJ-01-0020-T_PRO RJ-01-0020-T_RNA  61 Female 19.63000  1       0\n# 2 RJ-01-0038 RJ-01-0038-T_PRO RJ-01-0038-T_RNA  73   Male 22.46003  0       0\n# 3 RJ-01-0050 RJ-01-0050-T_PRO RJ-01-0050-T_RNA  69 Female 17.63085  0       0\n# 4 RJ-01-0069 RJ-01-0069-T_PRO RJ-01-0069-T_RNA  69 Female 17.48179  1       0\n# 5 RJ-01-0070 RJ-01-0070-T_PRO RJ-01-0070-T_RNA  65   Male 23.43750  0       0\n# 6 RJ-01-0074 RJ-01-0074-T_PRO RJ-01-0074-T_RNA  61   Male 23.66144  0       0\n\n# (2) Scores of the 32 modules in TACs and PDACs of RJ-cohort 1. \nmodule.ssgsea.pro.all <- read.xlsx("./data/Extended Data Table 4.xlsx", sheet = 2, startRow = 2, rowNames = T)\nmodule.ssgsea.pro.all <- t(module.ssgsea.pro.all)\n#      RJ-01-0143-N_PRO RJ-01-0768-N_PRO RJ-01-0697-N_PRO RJ-01-0609-N_PRO RJ-01-1055-N_PRO\n# ME01       0.34742611      0.253253916       0.28390477       0.32067554      0.325797851\n# ME02      -0.11467744      0.009051615      -0.03296699      -0.08755935     -0.096947986\n# ME03      -0.04291552     -0.035855079      -0.02943711      -0.05749618      0.016639009\n# ME04       0.06708347      0.034863920       0.05803330       0.10310726      0.007498371\n# ME05       0.19099018      0.100153070       0.14246697       0.16675071      0.127932887\n# ME06       0.03893163      0.240865770       0.14178269       0.07618613      0.038306853\n\n# (3) Lasso Score in RJ-cohort 1 RNA-seq\nrj1.rnaseq <- read.xlsx("./data/RNA/rj1.rnaseq.lasso.score.xlsx")\n#           ID     Proteomic_ID        RNAseq_ID  LassoScore LassoLevel LassoScoreRNA LassoLevelRNA\n# 1 RJ-01-0020 RJ-01-0020-T_PRO RJ-01-0020-T_RNA  0.22945083       High     -2.394123          High\n# 2 RJ-01-0038 RJ-01-0038-T_PRO RJ-01-0038-T_RNA -0.05725430       High     -2.561299           Low\n# 3 RJ-01-0050 RJ-01-0050-T_PRO RJ-01-0050-T_RNA -0.10574547       High     -2.720116           Low\n# 4 RJ-01-0069 RJ-01-0069-T_PRO RJ-01-0069-T_RNA -0.69376332        Low     -2.595342           Low\n# 5 RJ-01-0070 RJ-01-0070-T_PRO RJ-01-0070-T_RNA -0.03992765       High     -2.581288           Low\n# 6 RJ-01-0074 RJ-01-0074-T_PRO RJ-01-0074-T_RNA  0.17797893       High     -2.572467           Low\n\n#----------------------------------------------------------------------------------\n#  Step 2: Module score ~ OS/DFS (coxph, prognosis)\n#----------------------------------------------------------------------------------\nmodule.name <- rownames(module.ssgsea.pro.all)\n\nplot.info <- NULL\nplot.data <- rj1.cohort\nplot.info.os <- NULL\n\n## (1) Module score ~ OS\nfor (i in 1:length(module.name)) {\n  # data:  module score -> Low/High level (median cutoff)\n  plot.data <- plot.data %>% \n              mutate(ME_score = module.ssgsea.pro.all[module.name[i], plot.data$Proteomic_ID] %>% as.numeric()) %>% \n              mutate(ME_level=ifelse(ME_score >= median(ME_score),"High","Low")) %>% \n              mutate(ME_level=factor(ME_level,levels = c("Low","High")))\n  # coxph\n  fit <- coxph(Surv(OS_month, OS_status) ~ ME_level, data = plot.data)\n  fit.info <- summary(fit)\n  fit.p <- survdiff(Surv(OS_month, OS_status) ~ ME_level, data = plot.data)$pvalue\n  fit.info.out <- c(module.name[i], "OS", fit.info$conf.int[1, 1], fit.info$coefficients[1,5], "Log-rank test" )\n  plot.info.os <- rbind(plot.info.os, fit.info.out)\n}\nplot.info.os <- as.data.frame(plot.info.os)\ncolnames(plot.info.os) <- c("Module", "Factor", "Type","P", "Test")\n# result\nplot.info.os <- plot.info.os %>% \n                    mutate(Type=as.numeric(Type),P=as.numeric(P),\n                           Padj= p.adjust(P, method = "fdr")) %>% \n                    mutate(Tag=case_when(Type>1&P<0.05 ~ "Unfavorable",\n                                         Type<1&P<0.05 ~ "Favorable",\n                                         .default="notSig" ))\n## (1) Module score ~ DFS                    \nplot.data <- rj1.cohort\nplot.info.dfs <- NULL\nfor (i in 1:length(module.name)) {\n  # data:  module score -> Low/High level (median cutoff)\n  plot.data <- plot.data %>% \n              mutate(ME_score = module.ssgsea.pro.all[module.name[i], plot.data$Proteomic_ID] %>% as.numeric()) %>% \n              mutate(ME_level=ifelse(ME_score >= median(ME_score),"High","Low")) %>% \n              mutate(ME_level=factor(ME_level,levels = c("Low","High")))\n  # coxph  \n  fit <- coxph(Surv(DFS_month, DFS_status) ~ ME_level, data = plot.data)\n  fit.info <- summary(fit)\n  fit.p <- survdiff(Surv(DFS_month, DFS_status) ~ ME_level, data = plot.data)$pvalue\n  fit.info.out <- c(module.name[i], "DFS", fit.info$conf.int[1, 1], fit.info$coefficients[1,5], "Log-rank test" )\n  plot.info.dfs <- rbind(plot.info.dfs, fit.info.out)\n}\nplot.info.dfs <- as.data.frame(plot.info.dfs)\ncolnames(plot.info.dfs) <- c("Module", "Factor", "Type", "P", "Test")\n# result\nplot.info.dfs <- plot.info.dfs %>% \n                    mutate(Type=as.numeric(Type),P=as.numeric(P),\n                           Padj= p.adjust(P, method = "fdr")) %>% \n                    mutate(Tag=case_when(Type>1&P<0.05 ~ "Unfavorable",\n                                         Type<1&P<0.05 ~ "Favorable",\n                                         .default="notSig" ))\n#----------------------------------------------------------------------------------\n#  Step 3: Module score ~ continuous type clinical trait (cor)\n#----------------------------------------------------------------------------------\nplot.name <- c("Age","BMI","WBC","Hb","PLT","TBIL","DBIL","ALB","Glu","CA125","CA19_9","CEA","AFP","CA724","Diameter_tumor","Num_Pos_LN","Num_total_LN")\nplot.name[! plot.name %in% colnames(rj1.cohort)]\nplot.info.cat <- NULL\nfor (kkk in 1:length(plot.name)) {\n  plot.data <- rj1.cohort\n  plot.data$Plot <- plot.data[, which(colnames(plot.data) == plot.name[kkk])]\n  plot.data <- plot.data[which(!is.na(plot.data$Plot)), ]\n  plot.info.cat.sub <- NULL\n  for (i in 1:length(module.name)) {\n    plot.data$ME_score <- module.ssgsea.pro.all[module.name[i], plot.data$Proteomic_ID] %>% as.numeric()\n    sub <- c(module.name[i], plot.name[kkk], cor(plot.data$ME_score, plot.data$Plot, method = "spearman"), \n             cor.test(plot.data$ME_score, plot.data$Plot, method = "spearman")$p.value, "Spearman\'s correlation")\n    plot.info.cat.sub <- rbind(plot.info.cat.sub, sub)\n  }\n  plot.info.cat.sub <- as.data.frame(plot.info.cat.sub)\n  colnames(plot.info.cat.sub) <- c("Module", "Factor", "Type","P", "Test")\n  plot.info.cat.sub <- plot.info.cat.sub %>% \n                            mutate(Type=as.numeric(Type),\n                                   P=as.numeric(P),\n                                   Padj=p.adjust(P,method="fdr")) \n  plot.info.cat <- rbind(plot.info.cat, plot.info.cat.sub)\n}\nplot.info.cat <- plot.info.cat %>% \n                            mutate(Tag=case_when(Type<0&P<0.05 ~ "Negative",\n                                                 Type>0&P<0.05 ~ "Positive",\n                                                .default="notSig" ))\n#----------------------------------------------------------------------------------\n#  Step 4: Module score ~ category type clinical trait (Wilcoxon rank-sum test or ANOVA)\n#----------------------------------------------------------------------------------\nplot.name <- c("Gender","Drinking","Smoking","Ninv","T","N","Stage","Grade")\nplot.name[! plot.name %in% colnames(rj1.cohort)]\nplot.info.con <- NULL\nfor (kkk in 1:length(plot.name)) {\n  plot.data <- rj1.cohort\n  plot.data$Plot <- plot.data[, which(colnames(plot.data) == plot.name[kkk])]\n  plot.data <- plot.data[which(!is.na(plot.data$Plot)), ]\n  plot.info.con.sub <- NULL\n  if (length(unique(plot.data$Plot)) == 2) { # 2 types category -> wilcox\n    for (i in 1:length(module.name)) {\n      plot.data$ME_score <- module.ssgsea.pro.all[module.name[i], plot.data$Proteomic_ID] %>% as.numeric()\n      sub <- c(module.name[i], plot.name[kkk], NA, wilcox.test(plot.data$ME_score ~ as.factor(plot.data$Plot) )$p.value, "Wilcoxon rank-sum test")\n      plot.info.con.sub <- rbind(plot.info.con.sub, sub)\n    } \n  } else { # more than 2 types category -> anova\n    for (i in 1:length(module.name)) {\n      plot.data$ME_score <- module.ssgsea.pro.all[module.name[i], plot.data$Proteomic_ID] %>% as.numeric()\n      sub <- c(module.name[i], plot.name[kkk], NA, unlist(summary(aov(plot.data$ME_score ~ as.factor(plot.data$Plot) )))[9], "ANOVA")\n      plot.info.con.sub <- rbind(plot.info.con.sub, sub)\n    }\n  }\n  plot.info.con.sub <- as.data.frame(plot.info.con.sub)\n  colnames(plot.info.con.sub) <- c("Module", "Factor", "Type", "P", "Test")\n  plot.info.con.sub <- plot.info.con.sub %>% \n                            mutate(Type=as.numeric(Type),\n                                   P=as.numeric(P),\n                                   Padj=p.adjust(P,method="fdr")) \n  plot.info.con <- rbind(plot.info.con, plot.info.con.sub)\n}\nplot.info.con <- plot.info.con %>% mutate(Tag=ifelse(P<0.05,"Sig","notSig"))\n#----------------------------------------------------------------------------------\n#  Step 5: Module score ~ RNAseq subtype (Wilcoxon rank-sum test)\n#----------------------------------------------------------------------------------\nplot.name <- c("RNAseq_subtype")\nplot.name[! plot.name %in% colnames(rj1.rnaseq)]\nplot.info.rna <- NULL\nrj1.rnaseq$RNAseq_subtype <- rj1.cohort$RNAseq_subtype[match(rj1.rnaseq$ID, rj1.cohort$ID)]\nplot.data <- rj1.rnaseq\nfor (i in 1:length(module.name)) {\n  plot.data$ME_score <- module.ssgsea.pro.all[module.name[i], plot.data$Proteomic_ID] %>% as.numeric()\n  sub <- c(module.name[i], "RNAseq_subtype", \n           mean(plot.data$ME_score[which(plot.data$RNAseq_subtype == "Basal")]) - mean(plot.data$ME_score[which(plot.data$RNAseq_subtype == "Classical")]) , \n           wilcox.test(plot.data$ME_score ~ as.factor(plot.data$RNAseq_subtype) )$p.value, "Wilcoxon rank-sum test")\n  plot.info.rna <- rbind(plot.info.rna, sub)\n}\nplot.info.rna <- as.data.frame(plot.info.rna)\ncolnames(plot.info.rna) <- c("Module", "Factor", "Type", "P", "Test")\nplot.info.rna <- plot.info.rna %>% \n                    mutate(Type=as.numeric(Type),P=as.numeric(P),\n                           Padj= p.adjust(P, method = "fdr")) %>% \n                    mutate(Tag=case_when(Type>0&P<0.05 ~ "Basal",\n                                         Type<0&P<0.05 ~ "Classical",\n                                         .default="notSig" ))\n#----------------------------------------------------------------------------------\n#  Step 6: plot\n#----------------------------------------------------------------------------------\nplot.info <- rbind(plot.info.os, plot.info.dfs, plot.info.cat, plot.info.con, plot.info.rna)\nplot.info <- plot.info %>% mutate(LogP=-log10(P),\n                                  Module=factor(as.character(Module), levels = rev(module.name)),\n                                  Factor=factor(as.character(Factor), levels = c("OS","DFS","Age","BMI","WBC","Hb","PLT","TBIL","DBIL","ALB","Glu","CA125","CA19_9","CEA","AFP","CA724","Diameter_tumor","Num_Pos_LN","Num_total_LN","Gender","Drinking","Smoking","Ninv","T","N","Stage","Grade","RNAseq_subtype")))\n\np <- ggplot(plot.info, aes(Factor, Module)) +\n  geom_point(aes(size = LogP, colour = Tag, fill = Tag), shape = 16) + \n  xlab("") + ylab("")\np <- p + theme_base() + scale_size(range = c(0,10))\np <- p + theme(axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.5, size = 15))\np <- p + theme(axis.text.y = element_text(size = 20))\np <- p + scale_colour_manual(values = c(Favorable = "#00599F", Unfavorable = "#D01910", Negative = "#009632", Positive = "#8f00b7", Sig = "#ed7a00", Basal = "#ea6c59", Classical = "#1288a5", notSig = "#CCCCCC")) + theme(plot.background = element_blank())\nggsave(paste0("./results/Figure2/Figure2d.pdf"), p, width = 12, height = 11)\nwrite.xlsx(plot.info, "./results/Figure2/Figure2d.xlsx")\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br"),a("span",{staticClass:"line-number"},[s._v("59")]),a("br"),a("span",{staticClass:"line-number"},[s._v("60")]),a("br"),a("span",{staticClass:"line-number"},[s._v("61")]),a("br"),a("span",{staticClass:"line-number"},[s._v("62")]),a("br"),a("span",{staticClass:"line-number"},[s._v("63")]),a("br"),a("span",{staticClass:"line-number"},[s._v("64")]),a("br"),a("span",{staticClass:"line-number"},[s._v("65")]),a("br"),a("span",{staticClass:"line-number"},[s._v("66")]),a("br"),a("span",{staticClass:"line-number"},[s._v("67")]),a("br"),a("span",{staticClass:"line-number"},[s._v("68")]),a("br"),a("span",{staticClass:"line-number"},[s._v("69")]),a("br"),a("span",{staticClass:"line-number"},[s._v("70")]),a("br"),a("span",{staticClass:"line-number"},[s._v("71")]),a("br"),a("span",{staticClass:"line-number"},[s._v("72")]),a("br"),a("span",{staticClass:"line-number"},[s._v("73")]),a("br"),a("span",{staticClass:"line-number"},[s._v("74")]),a("br"),a("span",{staticClass:"line-number"},[s._v("75")]),a("br"),a("span",{staticClass:"line-number"},[s._v("76")]),a("br"),a("span",{staticClass:"line-number"},[s._v("77")]),a("br"),a("span",{staticClass:"line-number"},[s._v("78")]),a("br"),a("span",{staticClass:"line-number"},[s._v("79")]),a("br"),a("span",{staticClass:"line-number"},[s._v("80")]),a("br"),a("span",{staticClass:"line-number"},[s._v("81")]),a("br"),a("span",{staticClass:"line-number"},[s._v("82")]),a("br"),a("span",{staticClass:"line-number"},[s._v("83")]),a("br"),a("span",{staticClass:"line-number"},[s._v("84")]),a("br"),a("span",{staticClass:"line-number"},[s._v("85")]),a("br"),a("span",{staticClass:"line-number"},[s._v("86")]),a("br"),a("span",{staticClass:"line-number"},[s._v("87")]),a("br"),a("span",{staticClass:"line-number"},[s._v("88")]),a("br"),a("span",{staticClass:"line-number"},[s._v("89")]),a("br"),a("span",{staticClass:"line-number"},[s._v("90")]),a("br"),a("span",{staticClass:"line-number"},[s._v("91")]),a("br"),a("span",{staticClass:"line-number"},[s._v("92")]),a("br"),a("span",{staticClass:"line-number"},[s._v("93")]),a("br"),a("span",{staticClass:"line-number"},[s._v("94")]),a("br"),a("span",{staticClass:"line-number"},[s._v("95")]),a("br"),a("span",{staticClass:"line-number"},[s._v("96")]),a("br"),a("span",{staticClass:"line-number"},[s._v("97")]),a("br"),a("span",{staticClass:"line-number"},[s._v("98")]),a("br"),a("span",{staticClass:"line-number"},[s._v("99")]),a("br"),a("span",{staticClass:"line-number"},[s._v("100")]),a("br"),a("span",{staticClass:"line-number"},[s._v("101")]),a("br"),a("span",{staticClass:"line-number"},[s._v("102")]),a("br"),a("span",{staticClass:"line-number"},[s._v("103")]),a("br"),a("span",{staticClass:"line-number"},[s._v("104")]),a("br"),a("span",{staticClass:"line-number"},[s._v("105")]),a("br"),a("span",{staticClass:"line-number"},[s._v("106")]),a("br"),a("span",{staticClass:"line-number"},[s._v("107")]),a("br"),a("span",{staticClass:"line-number"},[s._v("108")]),a("br"),a("span",{staticClass:"line-number"},[s._v("109")]),a("br"),a("span",{staticClass:"line-number"},[s._v("110")]),a("br"),a("span",{staticClass:"line-number"},[s._v("111")]),a("br"),a("span",{staticClass:"line-number"},[s._v("112")]),a("br"),a("span",{staticClass:"line-number"},[s._v("113")]),a("br"),a("span",{staticClass:"line-number"},[s._v("114")]),a("br"),a("span",{staticClass:"line-number"},[s._v("115")]),a("br"),a("span",{staticClass:"line-number"},[s._v("116")]),a("br"),a("span",{staticClass:"line-number"},[s._v("117")]),a("br"),a("span",{staticClass:"line-number"},[s._v("118")]),a("br"),a("span",{staticClass:"line-number"},[s._v("119")]),a("br"),a("span",{staticClass:"line-number"},[s._v("120")]),a("br"),a("span",{staticClass:"line-number"},[s._v("121")]),a("br"),a("span",{staticClass:"line-number"},[s._v("122")]),a("br"),a("span",{staticClass:"line-number"},[s._v("123")]),a("br"),a("span",{staticClass:"line-number"},[s._v("124")]),a("br"),a("span",{staticClass:"line-number"},[s._v("125")]),a("br"),a("span",{staticClass:"line-number"},[s._v("126")]),a("br"),a("span",{staticClass:"line-number"},[s._v("127")]),a("br"),a("span",{staticClass:"line-number"},[s._v("128")]),a("br"),a("span",{staticClass:"line-number"},[s._v("129")]),a("br"),a("span",{staticClass:"line-number"},[s._v("130")]),a("br"),a("span",{staticClass:"line-number"},[s._v("131")]),a("br"),a("span",{staticClass:"line-number"},[s._v("132")]),a("br"),a("span",{staticClass:"line-number"},[s._v("133")]),a("br"),a("span",{staticClass:"line-number"},[s._v("134")]),a("br"),a("span",{staticClass:"line-number"},[s._v("135")]),a("br"),a("span",{staticClass:"line-number"},[s._v("136")]),a("br"),a("span",{staticClass:"line-number"},[s._v("137")]),a("br"),a("span",{staticClass:"line-number"},[s._v("138")]),a("br"),a("span",{staticClass:"line-number"},[s._v("139")]),a("br"),a("span",{staticClass:"line-number"},[s._v("140")]),a("br"),a("span",{staticClass:"line-number"},[s._v("141")]),a("br"),a("span",{staticClass:"line-number"},[s._v("142")]),a("br"),a("span",{staticClass:"line-number"},[s._v("143")]),a("br"),a("span",{staticClass:"line-number"},[s._v("144")]),a("br"),a("span",{staticClass:"line-number"},[s._v("145")]),a("br"),a("span",{staticClass:"line-number"},[s._v("146")]),a("br"),a("span",{staticClass:"line-number"},[s._v("147")]),a("br"),a("span",{staticClass:"line-number"},[s._v("148")]),a("br"),a("span",{staticClass:"line-number"},[s._v("149")]),a("br"),a("span",{staticClass:"line-number"},[s._v("150")]),a("br"),a("span",{staticClass:"line-number"},[s._v("151")]),a("br"),a("span",{staticClass:"line-number"},[s._v("152")]),a("br"),a("span",{staticClass:"line-number"},[s._v("153")]),a("br"),a("span",{staticClass:"line-number"},[s._v("154")]),a("br"),a("span",{staticClass:"line-number"},[s._v("155")]),a("br"),a("span",{staticClass:"line-number"},[s._v("156")]),a("br"),a("span",{staticClass:"line-number"},[s._v("157")]),a("br"),a("span",{staticClass:"line-number"},[s._v("158")]),a("br"),a("span",{staticClass:"line-number"},[s._v("159")]),a("br"),a("span",{staticClass:"line-number"},[s._v("160")]),a("br"),a("span",{staticClass:"line-number"},[s._v("161")]),a("br"),a("span",{staticClass:"line-number"},[s._v("162")]),a("br"),a("span",{staticClass:"line-number"},[s._v("163")]),a("br"),a("span",{staticClass:"line-number"},[s._v("164")]),a("br"),a("span",{staticClass:"line-number"},[s._v("165")]),a("br"),a("span",{staticClass:"line-number"},[s._v("166")]),a("br"),a("span",{staticClass:"line-number"},[s._v("167")]),a("br"),a("span",{staticClass:"line-number"},[s._v("168")]),a("br"),a("span",{staticClass:"line-number"},[s._v("169")]),a("br"),a("span",{staticClass:"line-number"},[s._v("170")]),a("br"),a("span",{staticClass:"line-number"},[s._v("171")]),a("br"),a("span",{staticClass:"line-number"},[s._v("172")]),a("br"),a("span",{staticClass:"line-number"},[s._v("173")]),a("br"),a("span",{staticClass:"line-number"},[s._v("174")]),a("br"),a("span",{staticClass:"line-number"},[s._v("175")]),a("br"),a("span",{staticClass:"line-number"},[s._v("176")]),a("br"),a("span",{staticClass:"line-number"},[s._v("177")]),a("br"),a("span",{staticClass:"line-number"},[s._v("178")]),a("br"),a("span",{staticClass:"line-number"},[s._v("179")]),a("br"),a("span",{staticClass:"line-number"},[s._v("180")]),a("br"),a("span",{staticClass:"line-number"},[s._v("181")]),a("br"),a("span",{staticClass:"line-number"},[s._v("182")]),a("br"),a("span",{staticClass:"line-number"},[s._v("183")]),a("br"),a("span",{staticClass:"line-number"},[s._v("184")]),a("br"),a("span",{staticClass:"line-number"},[s._v("185")]),a("br"),a("span",{staticClass:"line-number"},[s._v("186")]),a("br"),a("span",{staticClass:"line-number"},[s._v("187")]),a("br"),a("span",{staticClass:"line-number"},[s._v("188")]),a("br"),a("span",{staticClass:"line-number"},[s._v("189")]),a("br"),a("span",{staticClass:"line-number"},[s._v("190")]),a("br"),a("span",{staticClass:"line-number"},[s._v("191")]),a("br"),a("span",{staticClass:"line-number"},[s._v("192")]),a("br"),a("span",{staticClass:"line-number"},[s._v("193")]),a("br"),a("span",{staticClass:"line-number"},[s._v("194")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://s2.loli.net/2024/06/03/u62s14tWBDlrq89.png",alt:"image.png|600"}})]),s._v(" "),a("ul",[a("li",[a("code",[s._v("coxph(Surv(OS_month, OS_status) ~ ME_level, data = plot.data)")]),s._v(" 这行代码的作用是创建一个Cox比例风险模型，用来分析 "),a("code",[s._v("ME_level")]),s._v(" 变量如何影响生存时间 "),a("code",[s._v("OS_month")]),s._v("，其中 "),a("code",[s._v("OS_status")]),s._v(" 表示生存事件的状态，这个模型会考虑数据框 "),a("code",[s._v("plot.data")]),s._v(" 中的数据。")])]),s._v(" "),a("p",[s._v("这两行代码习惯值得学习（"),a("code",[s._v("命名方法")]),s._v("，"),a("code",[s._v("排序方法")]),s._v("）")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('plot.info <- rbind(plot.info.os, plot.info.dfs, plot.info.cat, plot.info.con, plot.info.rna)\n\nplot.info <- plot.info %>% mutate(LogP=-log10(P),\n                                  Module=factor(as.character(Module), levels = rev(module.name)),\n                                  Factor=factor(as.character(Factor), levels = c("OS","DFS","Age","BMI","WBC","Hb","PLT","TBIL","DBIL","ALB","Glu","CA125","CA19_9","CEA","AFP","CA724","Diameter_tumor","Num_Pos_LN","Num_total_LN","Gender","Drinking","Smoking","Ninv","T","N","Stage","Grade","RNAseq_subtype")))\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("生存分析图")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('library(survival)\nlibrary(survminer)\n#----------------------------------------------------------------------------------\n#  Step 1: Load the data\n#----------------------------------------------------------------------------------\n# (1) Sample information and clinical characteristics of the 191 PDAC patients (the RJ-cohort 1)\nrj1.cohort <- read.xlsx("./data/Extended Data Table 2.xlsx", startRow = 2)\n#           ID     Proteomic_ID        RNAseq_ID Age Gender      BMI\n# 1 RJ-01-0020 RJ-01-0020-T_PRO RJ-01-0020-T_RNA  61 Female 19.63000\n# 2 RJ-01-0038 RJ-01-0038-T_PRO RJ-01-0038-T_RNA  73   Male 22.46003\n# 3 RJ-01-0050 RJ-01-0050-T_PRO RJ-01-0050-T_RNA  69 Female 17.63085\n# 4 RJ-01-0069 RJ-01-0069-T_PRO RJ-01-0069-T_RNA  69 Female 17.48179\n\n# (2) Scores of the 32 modules in TACs and PDACs of RJ-cohort 1. \nmodule.ssgsea.pro.all <- read.xlsx("./data/Extended Data Table 4.xlsx", sheet = 2, startRow = 2, rowNames = T)\nmodule.ssgsea.pro.all <- t(module.ssgsea.pro.all)\n#      RJ-01-0143-N_PRO RJ-01-0768-N_PRO RJ-01-0697-N_PRO RJ-01-0609-N_PRO RJ-01-1055-N_PRO\n# ME01       0.34742611      0.253253916       0.28390477       0.32067554      0.325797851\n# ME02      -0.11467744      0.009051615      -0.03296699      -0.08755935     -0.096947986\n# ME03      -0.04291552     -0.035855079      -0.02943711      -0.05749618      0.016639009\n# ME04       0.06708347      0.034863920       0.05803330       0.10310726      0.007498371\n# ME05       0.19099018      0.100153070       0.14246697       0.16675071      0.127932887\n# ME06       0.03893163      0.240865770       0.14178269       0.07618613      0.038306853\n#----------------------------------------------------------------------------------\n#  Step 2: Overall survival stratified by ME11\n#----------------------------------------------------------------------------------\nplot.cohort <- rj1.cohort\nplot.cohort <- plot.cohort %>% \n                    mutate(ME11_pro = as.numeric(module.ssgsea.pro.all["ME11", Proteomic_ID]),\n                           ME11_pro_l = ifelse(ME11_pro>=median(ME11_pro),"High","Low"),\n                           ME11_pro_l = factor(as.character(ME11_pro_l), levels = c("Low","High"))) %>% \n                    mutate(Censoring_chemo_rev = Censoring_chemo,\n                           Censoring_chemo = factor(as.character(Censoring_chemo), levels = c("Chem","NoChem")),\n                           Censoring_chemo_rev = factor(as.character(Censoring_chemo_rev), levels = c("NoChem","Chem")))\n# coxph\ninfo <- summary(coxph(Surv(OS_month, OS_status) ~ ME11_pro_l, data = plot.cohort))\nanno.text <- ""\nfor (i in 1:nrow(info$conf.int)) {\n  anno.text <- paste0(anno.text, "\\n", paste0(rownames(info$conf.int)[i], " HR=", round(info$conf.int[i, 1], 3), " CI=", round(info$conf.int[i, 3], 3), "-", round(info$conf.int[i, 4], 3), " P=", signif(info$coefficients[i, 5], 4) ))\n}\nanno.text <- paste0(anno.text, "\\nKaplan-Meier P=", signif(survdiff(Surv(OS_month, OS_status) ~ ME11_pro_l, data = plot.cohort)$pvalue, 4) )\nanno.text <- str_replace_all(anno.text, "ME11_pro_l", "")\nfit <- survfit(Surv(OS_month, OS_status) ~ ME11_pro_l, data = plot.cohort)\np1 <- ggsurvplot(fit, \n                 data = plot.cohort,\n                 xlab = \'Time (Months)\',\n                 pval = TRUE,\n                 risk.table = TRUE, \n                 risk.table.height = 0.28,\n                 conf.int.alpha = 0.05,\n                 conf.int = TRUE, \n                 palette = c("#00599F","#d80700"),\n                 axes.offset = TRUE,\n                 break.time.by = 12,  xlim = c(0, 48),\n                 title= paste0("OS ME11_pro_l \\n", anno.text))\n#----------------------------------------------------------------------------------\n#  Step 2: KM curve in adjuvant therapy patients stratified by ME11\n#----------------------------------------------------------------------------------\nplot.cohort.sub <- plot.cohort %>% filter(Censoring_chemo == "Chem") %>% \n                          mutate(ME11_pro_l = ifelse(ME11_pro>= median(ME11_pro),"High","Low"),\n                                 ME11_pro_l = factor(as.character(ME11_pro_l), levels = c("Low","High")))\ninfo <- summary(coxph(Surv(OS_month, OS_status) ~ ME11_pro_l, data = plot.cohort.sub))\nanno.text <- ""\nfor (i in 1:nrow(info$conf.int)) {\n  anno.text <- paste0(anno.text, "\\n", paste0(rownames(info$conf.int)[i], " HR=", round(info$conf.int[i, 1], 3), " CI=", round(info$conf.int[i, 3], 3), "-", round(info$conf.int[i, 4], 3), " P=", signif(info$coefficients[i, 5], 4) ))\n}\nanno.text <- paste0(anno.text, "\\nKaplan-Meier P=", signif(survdiff(Surv(OS_month, OS_status) ~ ME11_pro_l, data = plot.cohort.sub)$pvalue, 4) )\nanno.text <- str_replace_all(anno.text, "ME11_pro_l", "")\nfit <- survfit(Surv(OS_month, OS_status) ~ ME11_pro_l, data = plot.cohort.sub)\np2 <- ggsurvplot(fit, \n                 data = plot.cohort.sub,\n                 xlab = \'Time (Months)\',\n                 pval = TRUE,\n                 risk.table = TRUE, \n                 risk.table.height = 0.28,\n                 conf.int.alpha = 0.05,\n                 conf.int = TRUE, \n                 palette = c("#00599F","#d80700"),\n                 axes.offset = TRUE,\n                 break.time.by = 12,  xlim = c(0, 48),\n                 title= paste0("OS ME11_pro_l Chem \\n", anno.text))\n#----------------------------------------------------------------------------------\n#  Step 2: KM curve in no adjuvant therapy patients stratified by ME11\n#----------------------------------------------------------------------------------\nplot.cohort.sub <- plot.cohort %>% filter(Censoring_chemo == "NoChem") %>% \n                      mutate(ME11_pro_l = ifelse(ME11_pro >= median(ME11_pro),"High","Low"),\n                             ME11_pro_l = factor(as.character(ME11_pro_l), levels = c("Low","High")))\ninfo <- summary(coxph(Surv(OS_month, OS_status) ~ ME11_pro_l, data = plot.cohort.sub))\nanno.text <- ""\nfor (i in 1:nrow(info$conf.int)) {\n  anno.text <- paste0(anno.text, "\\n", paste0(rownames(info$conf.int)[i], " HR=", round(info$conf.int[i, 1], 3), " CI=", round(info$conf.int[i, 3], 3), "-", round(info$conf.int[i, 4], 3), " P=", signif(info$coefficients[i, 5], 4) ))\n}\nanno.text <- paste0(anno.text, "\\nKaplan-Meier P=", signif(survdiff(Surv(OS_month, OS_status) ~ ME11_pro_l, data = plot.cohort.sub)$pvalue, 4) )\nanno.text <- str_replace_all(anno.text, "ME11_pro_l", "")\nfit <- survfit(Surv(OS_month, OS_status) ~ ME11_pro_l, data = plot.cohort.sub)\np3 <- ggsurvplot(fit, \n                 data = plot.cohort.sub,\n                 xlab = \'Time (Months)\',\n                 pval = TRUE,\n                 risk.table = TRUE, \n                 risk.table.height = 0.28,\n                 conf.int.alpha = 0.05,\n                 conf.int = TRUE, \n                 palette = c("#00599F","#d80700"),\n                 axes.offset = TRUE,\n                 break.time.by = 12,  xlim = c(0, 48),\n                 title= paste0("OS ME11_pro_l NoChem \\n", anno.text))\n## output\np <- arrange_ggsurvplots(list(p1, p2, p3), ncol = 3, nrow = 1, print = FALSE)\nggsave(paste0("./results/Figure2/Figure2e.pdf"), p, width = 18, height = 8)\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br"),a("span",{staticClass:"line-number"},[s._v("59")]),a("br"),a("span",{staticClass:"line-number"},[s._v("60")]),a("br"),a("span",{staticClass:"line-number"},[s._v("61")]),a("br"),a("span",{staticClass:"line-number"},[s._v("62")]),a("br"),a("span",{staticClass:"line-number"},[s._v("63")]),a("br"),a("span",{staticClass:"line-number"},[s._v("64")]),a("br"),a("span",{staticClass:"line-number"},[s._v("65")]),a("br"),a("span",{staticClass:"line-number"},[s._v("66")]),a("br"),a("span",{staticClass:"line-number"},[s._v("67")]),a("br"),a("span",{staticClass:"line-number"},[s._v("68")]),a("br"),a("span",{staticClass:"line-number"},[s._v("69")]),a("br"),a("span",{staticClass:"line-number"},[s._v("70")]),a("br"),a("span",{staticClass:"line-number"},[s._v("71")]),a("br"),a("span",{staticClass:"line-number"},[s._v("72")]),a("br"),a("span",{staticClass:"line-number"},[s._v("73")]),a("br"),a("span",{staticClass:"line-number"},[s._v("74")]),a("br"),a("span",{staticClass:"line-number"},[s._v("75")]),a("br"),a("span",{staticClass:"line-number"},[s._v("76")]),a("br"),a("span",{staticClass:"line-number"},[s._v("77")]),a("br"),a("span",{staticClass:"line-number"},[s._v("78")]),a("br"),a("span",{staticClass:"line-number"},[s._v("79")]),a("br"),a("span",{staticClass:"line-number"},[s._v("80")]),a("br"),a("span",{staticClass:"line-number"},[s._v("81")]),a("br"),a("span",{staticClass:"line-number"},[s._v("82")]),a("br"),a("span",{staticClass:"line-number"},[s._v("83")]),a("br"),a("span",{staticClass:"line-number"},[s._v("84")]),a("br"),a("span",{staticClass:"line-number"},[s._v("85")]),a("br"),a("span",{staticClass:"line-number"},[s._v("86")]),a("br"),a("span",{staticClass:"line-number"},[s._v("87")]),a("br"),a("span",{staticClass:"line-number"},[s._v("88")]),a("br"),a("span",{staticClass:"line-number"},[s._v("89")]),a("br"),a("span",{staticClass:"line-number"},[s._v("90")]),a("br"),a("span",{staticClass:"line-number"},[s._v("91")]),a("br"),a("span",{staticClass:"line-number"},[s._v("92")]),a("br"),a("span",{staticClass:"line-number"},[s._v("93")]),a("br"),a("span",{staticClass:"line-number"},[s._v("94")]),a("br"),a("span",{staticClass:"line-number"},[s._v("95")]),a("br"),a("span",{staticClass:"line-number"},[s._v("96")]),a("br"),a("span",{staticClass:"line-number"},[s._v("97")]),a("br"),a("span",{staticClass:"line-number"},[s._v("98")]),a("br"),a("span",{staticClass:"line-number"},[s._v("99")]),a("br"),a("span",{staticClass:"line-number"},[s._v("100")]),a("br"),a("span",{staticClass:"line-number"},[s._v("101")]),a("br"),a("span",{staticClass:"line-number"},[s._v("102")]),a("br"),a("span",{staticClass:"line-number"},[s._v("103")]),a("br"),a("span",{staticClass:"line-number"},[s._v("104")]),a("br"),a("span",{staticClass:"line-number"},[s._v("105")]),a("br"),a("span",{staticClass:"line-number"},[s._v("106")]),a("br"),a("span",{staticClass:"line-number"},[s._v("107")]),a("br"),a("span",{staticClass:"line-number"},[s._v("108")]),a("br"),a("span",{staticClass:"line-number"},[s._v("109")]),a("br"),a("span",{staticClass:"line-number"},[s._v("110")]),a("br")])]),a("p",[s._v("最后结果还挺好看的，值得一学（已经整理到文件夹里，跑的通）\n"),a("img",{attrs:{src:"https://s2.loli.net/2024/06/04/bqpAlMemHPRkQLr.png",alt:"image.png|700"}})]),s._v(" "),a("ul",[a("li",[s._v("另外，生存分析用"),a("code",[s._v("library(survival)")]),s._v("，"),a("code",[s._v("library(survminer)")]),s._v("跑，数据最少只要两列（一列时间，一列是否存活），后边用上"),a("code",[s._v("coxph")]),s._v("，很方便去做风险因素回归！")])]),s._v(" "),a("h3",{attrs:{id:"figure-3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#figure-3"}},[s._v("#")]),s._v(" Figure 3")]),s._v(" "),a("p",[a("strong",[s._v("Establishing an optimal proteomics-level prognostic risk model using the LASSO-Cox regression")])]),s._v(" "),a("p",[s._v("利用LASSO-Cox回归，建立最佳蛋白质组学预后风险模型")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('library(glmnet)\nlibrary(openxlsx)\nlibrary(survminer)\nlibrary(survival)\nlibrary(tidyverse)\nlibrary(RColorBrewer)\nlibrary(ComplexHeatmap)\nlibrary(forestmodel)\nlibrary(ROCR)\ndir.create("./results/Figure3/lasso",recursive = T)\n#----------------------------------------------------------------------------------\n#  Step 1: load data\n#----------------------------------------------------------------------------------\n## PDAC Tumor proteomics\npdac.pro  <- readRDS(\'./data/proteomics/20230412_PDAC_PRO_exp.rds\') \npdac.pro  <- pdac.pro [,grep(\'_T_\',colnames(pdac.pro))]   %>% t() %>% as.data.frame() # 191 tumor samples * 4787 protein\n## WGCNA protein\nwgcna <- readRDS("./data/proteomics/wgcna/2D-node.data.rds")\npdac.pro <- pdac.pro [,intersect(wgcna$Gene,colnames(pdac.pro))] #  191 samples * 3906 protein\n## PDAC clinical data\ncli.pdac <- readRDS(\'./data/clinical/20230412_PDAC_191_patients_clinical.rds\')\nrownames(cli.pdac) <- cli.pdac$ID\n## Lasso data\ny.train <- data.frame(time=cli.pdac$Time_OS,\n                      status=cli.pdac$Censoring_OS,\n                      row.names = row.names(cli.pdac)) %>% \n           na.omit(y.train) %>% \n           as.matrix() \nx.train <- pdac.pro[row.names(y.train),] %>% as.matrix() %>% na.omit()\ny.train <- y.train[row.names(x.train),]\n#----------------------------------------------------------------------------------\n#  Step 2: Fit the Lasso Regression Model\n#----------------------------------------------------------------------------------\nset.seed(1000) \nfit <-glmnet(x=x.train,\n             y=y.train, \n             family = "cox",  # cox : cox , binomial : logistic\n             alpha  = 1)      # 1 : lasso penalty, 0 : ridge penalty.\npdf(\'./results/Figure3/lasso/0.Coefficients.pdf\',width = 5,height = 4)\nplot(fit,xvar="lambda",label=F) \ndev.off()\n# Cross-validation\ncvfit <- cv.glmnet(x=x.train,\n                   y=y.train,\n                   family = "cox",\n                   type.measure="deviance",  \n                   alpha  = 1,\n                   nfolds = 10)\npng(paste0(\'./results/Figure3/lasso/S5A-Coeff.png\'), width = 5,height = 5,res=1200,units="in")\nplot(fit,xvar="lambda",label=F) \nabline(v = log(cvfit$lambda.min), col = "black",lty=2)\ntext(-4,-4, labels = paste0("lambda.min:  ", round(cvfit$lambda.min,4)),col = "black",cex = 0.75)\ndev.off()\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br")])]),a("ul",[a("li",[s._v("library(glmnet) -- glmnet()，cv.glmnet()，glmnet()，")]),s._v(" "),a("li",[s._v("library(forestmodel) -- forest_model()\n"),a("img",{attrs:{src:"https://s2.loli.net/2024/06/04/JTl9VghPoKzfavc.png",alt:"image.png|400"}})]),s._v(" "),a("li",[s._v("library(ROCR) -- predition()，performance()，")])]),s._v(" "),a("h3",{attrs:{id:"figure-4"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#figure-4"}},[s._v("#")]),s._v(" Figure 4")]),s._v(" "),a("p",[s._v("Chemotherapy biomarker -- Cox proportional-hazards models in terms of OS")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('library(openxlsx)\nlibrary(tidyverse)\nlibrary(stringr)\nlibrary(survival)\nlibrary(survminer)\nlibrary(pbapply)\nlibrary(ggthemes)\ndir.create("./results/Figure4")\n#----------------------------------------------------------------------------------\n#  Step 1: Load the Data\n#----------------------------------------------------------------------------------\ndeg <- readRDS("./data/proteomics/wgcna/2D-node.data.rds")  # DEG & module genes\npro <- readRDS("./data/proteomics/20230412_PDAC_PRO_exp.rds")\ncli <- readRDS("./data/clinical/20230412_PDAC_191_patients_clinical.rds")\n#----------------------------------------------------------------------------------\n#  Step 2: Coxph data\n#----------------------------------------------------------------------------------\n# clinical data + DEG genes\' expression data\ndeg <- deg %>% filter(proSig !="zz") %>% pull(Gene) # 1860 DEG genes\nrownames(cli) <- cli$ID\nid.inter <- intersect(rownames(cli),colnames(pro)) # 191 patients\npro <- pro[deg,id.inter] %>% t()\nidentical(rownames(cli),rownames(pro))\nbiomarker_data <- cbind(cli %>% dplyr::select(OS_Time,OS_Status,Censoring_chemo),pro)\n# category attribute: chemotherapy treatment\nbiomarker_data <- biomarker_data %>% mutate(chem=factor(Censoring_chemo,levels = c("0","1")))\n#----------------------------------------------------------------------------------\n#  Step 3: Coxph\n#----------------------------------------------------------------------------------\n# Coxph : OS ~ chemotherapy*gene\nls_re <- pbapply::pblapply(colnames(pro),FUN=function(g){\n    data <- biomarker_data %>% select(OS_Time,OS_Status,chem) %>%\n            mutate(Gene=biomarker_data%>%pull(g))\n    fit  <- coxph( Surv(OS_Time,OS_Status) ~ Gene*chem ,data=data) ## interaction term\n    broom::tidy(fit) %>% mutate(HR=exp(estimate)) %>% select(p.value,HR) %>% t() %>% as.vector() \n})\n# result\nres <- do.call(rbind,ls_re)\ncolnames(res) <- c("biomarker_p","biomarker_HR","chemotherapy_p",\n                    "chemotherapy_HR","interaction_p","interaction_HR")\n## predictive biomarker\nres <- res %>% as_tibble() %>% mutate(Gene=colnames(pro)) %>% \n            arrange(interaction_p) %>%  \n            dplyr::select(Gene,everything())\n# cutoff \nres[which(res$interaction_HR>1 & res$interaction_p <0.05),"group"] = "bad_biomarker"\nres[which(res$interaction_HR<1 & res$interaction_p <0.05),"group"] = "good_biomarker"\ntable(res$group)\n#----------------------------------------------------------------------------------\n#  Step 4: Visualization\n#----------------------------------------------------------------------------------\ncolor.tri <- c("#D01910","#00599F","#444444")  # up ,down ,not\n## volcano\nres <- res %>% mutate(group=factor(group,levels = c("bad_biomarker","good_biomarker")),\n                      Label=Gene,\n                      Label=replace(Label,is.na(group),""))\nres <- res %>% mutate(log2HR=log2(interaction_HR)) %>% \n        mutate(logP= -log10(interaction_p))\np <- ggscatter(res,\n               x = "log2HR", y = "logP",\n               color = "group", size = 1,\n               main = paste0("Predictive biomarker for chemotherapy"),\n               xlab = "log2(HR)", ylab = "-log10(Pvalue)",\n               palette = color.tri,\n               label = res$Label,font.label = 6, , repel = T)+\n               theme_base()+\n               geom_hline(yintercept = -log10(0.05), linetype="dashed", color = "#222222") +\n      theme(plot.background = element_blank())\nggsave("./results/Figure4/4A-Predictive-biomarker.pdf", p, width = 10, height = 8)\nwrite.xlsx(as.data.frame(res),"./results/Figure4/4A-Predictive-biomarker.xlsx",colNames=T,rowNames=F,overwrite = T)\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br"),a("span",{staticClass:"line-number"},[s._v("59")]),a("br"),a("span",{staticClass:"line-number"},[s._v("60")]),a("br"),a("span",{staticClass:"line-number"},[s._v("61")]),a("br"),a("span",{staticClass:"line-number"},[s._v("62")]),a("br"),a("span",{staticClass:"line-number"},[s._v("63")]),a("br"),a("span",{staticClass:"line-number"},[s._v("64")]),a("br"),a("span",{staticClass:"line-number"},[s._v("65")]),a("br"),a("span",{staticClass:"line-number"},[s._v("66")]),a("br"),a("span",{staticClass:"line-number"},[s._v("67")]),a("br"),a("span",{staticClass:"line-number"},[s._v("68")]),a("br"),a("span",{staticClass:"line-number"},[s._v("69")]),a("br"),a("span",{staticClass:"line-number"},[s._v("70")]),a("br")])]),a("ul",[a("li",[s._v('x = "log2HR", y = "logP"，火山图常见，但是横轴为风险指标的可不常见哦！！\n'),a("img",{attrs:{src:"https://s2.loli.net/2024/06/04/uMAV1iJ6XtOHolm.png",alt:"image.png|500"}})])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('library(forestmodel)\nlibrary(RColorBrewer)\n#----------------------------------------------------------------------------------\n#  Step 1: Load the Data\n#----------------------------------------------------------------------------------\n# Sample information and clinical characteristics of the 191 PDAC patients (the RJ-cohort 1)\nrj1 <- read.xlsx("./data/Extended Data Table 2.xlsx", startRow = 2)\nrj1$`LassoLevel (High vs. Low)` <- ifelse(rj1$LassoLevel == \'High\', 1, 0)\nrj1$`Adjuvant_therapy (Yes vs. No)` <- ifelse(rj1$Censoring_chemo == \'Chem\', 1, 0)\nrj1$`Stage (III vs. I_II)` <- ifelse(rj1$Stage == \'III\', 1, 0)\nrj1$`NDUFB8 (High vs. Low)` <- ifelse(rj1$NDUFB8_l == \'High\', 1, 0)\nrj1$`CEMIP2 (High vs. Low)` <- ifelse(rj1$CEMIP2_l == \'High\', 1, 0)\nrj1$`Sex (Male vs. Female)` <- ifelse(rj1$Gender == \'Male\', 1, 0)\nrj1$`Margin (R1 vs. R0)` <- ifelse(rj1$Margin == \'R1\', 1, 0)\nrj1$`Smoking (Yes vs. No)` <- rj1$Smoking\nrj1$`Drinking (Yes vs. No)` <- rj1$Drinking\n#----------------------------------------------------------------------------------\n#  Step 2: plot for NDUFB8 * Adjuvant_therapy\n#----------------------------------------------------------------------------------\n# custom panels for column: Adjust the font style, thickness, and column width of variables in the graph \nforest.panels <- list(\n  list(width = 0.01),\n  list(width = 0.1, display = ~variable, \n       fontface = "bold", heading = "Variable"),\n  list(width = 0.1, display = ~level),\n  list(width = 0.05, display = ~n, hjust = 1, heading = "N"),\n  list(width = 0.03, item = "vline", hjust = 0.5),\n  list(width = 0.55, item = "forest", hjust = 0.5, \n       heading = "Hazard ratio", linetype = "dashed",line_x = 0),\n  list(width = 0.03, item = "vline", hjust = 0.5),\n  list(width = 0.12, display = ~ ifelse(reference, "Reference", sprintf("%0.3f (%0.3f, %0.3f)",\n                                                                        trans(estimate), trans(conf.low), trans(conf.high))), display_na = NA),\n  list(width = 0.03,\n       display = ~ ifelse(reference, "", format.pval(p.value, digits = 1, eps = 0.001) ),\n       display_na = NA, hjust = 1, heading = "p"),\n  list(width = 0.03))\n\nInteraction <- rj1[["NDUFB8"]] * rj1[[\'Adjuvant_therapy (Yes vs. No)\']]\n\npdf(\'./results/Figure4/Figure4b-1.pdf\', width = 10, height = 6)\nprint(forest_model(coxph(as.formula(paste0(\'Surv(OS_month, OS_status) ~\', \'`\', "NDUFB8", \'`\', \'+ `Adjuvant_therapy (Yes vs. No)` + Interaction + Age + `Sex (Male vs. Female)` + `Stage (III vs. I_II)` + `Margin (R1 vs. R0)` + CA19_9 + `Smoking (Yes vs. No)` + `Drinking (Yes vs. No)`\')), data = rj1), panels = forest.panels, factor_separate_line = F))\ndev.off()\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br")])]),a("p",[s._v("风险森林图！\n"),a("img",{attrs:{src:"https://s2.loli.net/2024/06/04/jPOhMDsG1ZJmuik.png",alt:"image.png|400"}})]),s._v(" "),a("p",[s._v("上面这一步代码，大多数都是用于准备，下面这个代码是出图的主要函数")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("#----------------------------------------------------------------------------------\n#  Step 3: plot for CEMIP2 * Adjuvant_therapy\n#----------------------------------------------------------------------------------\nInteraction <- rj1[[\"CEMIP2\"]] * rj1[['Adjuvant_therapy (Yes vs. No)']]\npdf('./results/Figure4/Figure4b-2.pdf', width = 10, height = 6)\nprint(forest_model(coxph(as.formula(paste0('Surv(OS_month, OS_status) ~', '`', \"CEMIP2\", '`', '+ `Adjuvant_therapy (Yes vs. No)` + Interaction + Age + `Sex (Male vs. Female)` + `Stage (III vs. I_II)` + `Margin (R1 vs. R0)` + CA19_9 + `Smoking (Yes vs. No)` + `Drinking (Yes vs. No)`')), data = rj1), panels = forest.panels, factor_separate_line = F))\ndev.off()\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("h3",{attrs:{id:"figure-5"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#figure-5"}},[s._v("#")]),s._v(" Figure 5")]),s._v(" "),a("p",[s._v("后边的只更换了队列数据，一样绘制了几个生存曲线图，验证其筛选出来的分子是有用的，原理和前面前面的类似。")]),s._v(" "),a("h2",{attrs:{id:"感想"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#感想"}},[s._v("#")]),s._v(" 感想")]),s._v(" "),a("p",[s._v("读了这篇文章，主要的感觉就是 -- 比较短，五六页吧，就结束了，但是意义还蛮大的，发现了很有用的（差异显著的）预测化疗结果的指标，感觉的不难，但是不认真整理的话，其中的"),a("RouterLink",{attrs:{to:"/01.科研学习/02.生信分析/24.WGCNA.html"}},[s._v("WGCNA")]),s._v("，"),a("RouterLink",{attrs:{to:"/01.科研学习/02.生信分析/23.临床相关性.html"}},[s._v("Survival analysis")]),s._v("，相关性分析，还是做不好的。")],1),s._v(" "),a("p",[s._v("但是这篇文章，为啥能发到这个上面呢？比别的用太多的WGCNA文章好在哪里呢？我觉得主要是因为研究内容（蛋白质组数据）比较新吧，再结合着临床的队列，是一篇临床应用价值比较大的文章呢！")]),s._v(" "),a("p",[s._v("只不过，我稍稍查了一下，现在一个蛋白组还是接近一个"),a("code",[s._v("达不溜")]),s._v("呢，190+个患者的蛋白组信息，还有转录组打分呢，多多少少需要两百吧，还需要人力物力进行随访一千多人呢，上限就不清楚了，咱做不起做不起。")])])}),[],!1,null,null,null);a.default=t.exports}}]);