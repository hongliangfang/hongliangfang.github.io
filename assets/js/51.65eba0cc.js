(window.webpackJsonp=window.webpackJsonp||[]).push([[51],{370:function(s,t,a){"use strict";a.r(t);var n=a(7),e=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h2",{attrs:{id:"seurat"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#seurat"}},[s._v("#")]),s._v(" Seurat")]),s._v(" "),t("p",[s._v("Seurat 3+ 补充了这个函数 —— SCTransform() = NormalizeData() + ScaleData() + FindVariableFeatures()")]),s._v(" "),t("blockquote",[t("p",[s._v("对测序深度的矫正效果好于log标准化（10w以内的细胞建议使用SCT标准化）；也可以用于矫正线粒体等因素影响，但不可以用于批次矫正")])]),s._v(" "),t("p",[s._v("NormalizeData() + ScaleData() + FindVariableFeatures()后的数据：")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("seurat_obj--assays--\n\tRNA\n\t\tcounts：原始矩阵\n\t\tdata：\n\t\t\tnormalize（log）后的矩阵, \n\t\t\tscale.data: scale后的矩阵, \n\t\t\tvar.features: 找出的2000个variable features\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("p",[s._v("SCTransform()后的数据：")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("seurat_obj--assays--\n\tRNA--仍然保留\n\tSCT：\n\t\tcounts：原始矩阵\n\t\tdata：\n\t\t\t标准后的数据,\n\t\t\tscale.data: 缩放后的数据, \n\t\t\tvar.features: 高度变化的特征\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("p",[s._v("存放于不同的slot（RNA，SCT这一级），输入PCs越多，能找到更多的生物学差异var.features（特征基因），也会引入更多的技术误差，SCT找了更多的var.features")]),s._v(" "),t("h3",{attrs:{id:"标准处理流程"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#标准处理流程"}},[s._v("#")]),s._v(" 标准处理流程：")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('# 数据来源 \n# https://cf.10xgenomics.com/samples/cell/pbmc3k/pbmc3k_filtered_gene_bc_matrices.tar.gz  \n\n\nlibrary(Seurat)  \nlibrary(SeuratData)  \nlibrary(ggplot2)  \nlibrary(patchwork)  \nlibrary(dplyr)  \n\n\npbmc.data <- Read10X(data.dir = "filtered_gene_bc_matrices/hg19/")   \npbmc <- CreateSeuratObject(counts = pbmc.data, project = "pbmc3k", min.cells = 3, min.features = 200)  \n\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br")])]),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v(">pbmc  \nAn object of class Seurat   \n13714 features across 2700 samples within 1 assay   \nActive assay: RNA (13714 features, 0 variable features)\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('pbmc[["percent.mt"]] <- PercentageFeatureSet(pbmc, pattern = "^MT-")   # 计算线粒体比例，基因名中，人类线粒体基因以MT开头，小鼠以mt开头\n\n#Visualize QC metrics as a violin plot  \nVlnPlot(pbmc, features = c("nFeature_RNA", "nCount_RNA", "percent.mt"), ncol = 3)  \n\n# FeatureScatter is typically used to visualize feature-feature relationships, \n# but can be used for anything calculated by the object, i.e. columns in object metadata, PC scores etc.  \nplot1 <- FeatureScatter(pbmc, feature1 = "nCount_RNA", feature2 = "percent.mt")   \nplot2 <- FeatureScatter(pbmc, feature1 = "nCount_RNA", feature2 = "nFeature_RNA")   \nplot1 + plot2  \n\npbmc <- subset(pbmc, subset = nFeature_RNA > 200 & nFeature_RNA < 2500 & percent.mt < 5)  \npbmc <- NormalizeData(pbmc, normalization.method = "LogNormalize", scale.factor = 1e4)   \npbmc <- FindVariableFeatures(pbmc, selection.method = \'vst\', nfeatures = 2000)  \n\n# Identify the 10 most highly variable genes  \ntop10 <- head(VariableFeatures(pbmc), 10)  \n\n# plot variable features with and without labels  \nplot1 <- VariableFeaturePlot(pbmc)  \nplot2 <- LabelPoints(plot = plot1, points = top10, repel = TRUE)  \nplot1 + plot2  \npbmc <- ScaleData(pbmc, vars.to.regress = "percent.mt")  \npbmc <- RunPCA(pbmc, features = VariableFeatures(object = pbmc))    \n\npbmc <- FindNeighbors(pbmc, dims = 1:10)  \npbmc <- FindClusters(pbmc, resolution = 0.5)  \n\n# Look at cluster IDs of the first 5 cells  \nhead(Idents(pbmc), 5)  \ntable(pbmc$seurat_clusters)   \npbmc <- RunUMAP(pbmc, dims = 1:10)  \n\n# note that you can set `label = TRUE` or use the LabelClusters function to help label individual clusters  \nDimPlot(pbmc, reduction = \'umap\')  \nVlnPlot(pbmc, features = c("MS4A1", "CD79A"))   \nFeaturePlot(pbmc, features = c("MS4A1", "GNLY", "CD3E", "CD14", "FCER1A", "FCGR3A", "LYZ", "PPBP", "CD8A"))  \n\n\n# 注释命名部分\nnew.cluster.ids <- c("Naive CD4 T", "CD14+ Mono", "Memory CD4 T", "B", "CD8 T", "FCGR3A+ Mono", "NK", "DC", "Platelet")  \nnames(new.cluster.ids) <- levels(pbmc)  \npbmc <- RenameIdents(pbmc, new.cluster.ids)  \nDimPlot(pbmc, reduction = \'umap\', label = TRUE, pt.size = 0.5) + NoLegend()\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br")])]),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("> pbmc  \nAn object of class Seurat   \n13714 features across 2638 samples within 1 assay   \nActive assay: RNA (13714 features, 2000 variable features)  \n2 dimensional reductions calculated: pca, umap\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("h3",{attrs:{id:"标记基因的可视化"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#标记基因的可视化"}},[s._v("#")]),s._v(" 标记基因的可视化")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("# 小提琴图\nVlnPlot(pbmc, features = c(\"MS4A1\", \"CD79A\"))  \n\n# 坐标映射图\nFeaturePlot(pbmc, features = c(\"MS4A1\", \"CD79A\"))  \n\n# 峰峦图\nRidgePlot(pbmc, features = c(\"MS4A1\", \"CD79A\"), ncol = 1)  \n\n# 气泡图\nfeatures= c('IL7R', 'CCR7','CD14', 'LYZ',  'IL7R', 'S100A4',\"MS4A1\", \"CD8A\", 'FCGR3A', 'MS4A7', 'GNLY', 'NKG7','FCER1A', 'CST3','PPBP')  \n\nDotPlot(pbmc, features = unique(features)) + RotatedAxis() + coord_flip()\n\n# 热图\nDoHeatmap(subset(pbmc, downsample = 100), features = features, size = 3)\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br")])]),t("p",[s._v("怎么改名字呢？")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("new_cluster_ids <- c('T cell','B cell') # 按照levels(pbmc)的顺序排列\nnames(new_cluster_ids) <- levels(mergeHarmony)\nmergeHarmony <- RenameIdents(mergeHarmony, new_cluster_ids)\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("celltype = data.frame(ClusterID = 0:34, celltype='unkown')\ncelltype[celltype$ClusterID %in% c(31),2]='T cells' \ncelltype[celltype$ClusterID %in% c(24,32),2]='B cells'\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h3",{attrs:{id:"细分亚群"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#细分亚群"}},[s._v("#")]),s._v(" 细分亚群")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("# 下面的 TP53 > 10 仅仅是举例方便\n\nhighCells <- colnames(subset(x = sce, subset = TP53 > 10, slot = 'counts'))\n\nhighORlow <- ifelse(colnames(sce) %in% highCells,'high','low')\n\ntable(highORlow)\n\nsce@meta.data$highORlow=highORlow\n\nmarkers <- FindMarkers(sce, ident.1 = \"high\", \n                       group.by = 'highORlow', \n                       subset.ident = \"0\")\nhead(x = markers)\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br")])]),t("h3",{attrs:{id:"增加meta信息"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#增加meta信息"}},[s._v("#")]),s._v(" 增加meta信息")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('pmbc <- AddMetaData(object = pmbc,     #seurat对象\n                    metadata = age,    #需要添加的metadata\n                    col.name = "age")  #给新添加的metadata命名\n\npbmc$metaname <- NewmetaName\n\n\nIdents(object = pbmc, cells = 1:10) <- "orig.ident" #将前10个细胞ident设置为"orig.ident"\nIdents(object = pbmc) <- "orig.ident" #将"orig.ident"设置为pbmc的"active.ident"\n\npbmc <- RenameIdents(object = pbmc, `CD4 T cells` = "T Helper cells")\n\n\nEmbeddings(object = pbmc, reduction = "pca") #检索每个细胞的PC矩阵\nLoadings(object = pbmc, reduction = "pca") #检索每个基因的PC矩阵\n\n\n\n# FetchData可以从expression matrices, cell embeddings或metadata中取出任何值\nhead(FetchData(object = pbmc, vars = c("PC_1", "percent.mt", "MS4A1")))\n#                        PC_1 percent.mt    MS4A1\n# AAACATACAACCAC-1 -4.7296855  3.0177759 0.000000\n# AAACATTGAGCTAC-1 -0.5174029  3.7935958 2.583047\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br")])]),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("Annotation = clustertable[match(as.numeric(as.character(seurat_data@active.ident)), clustertable[, 1]), 2]\n\n`clustertable`是一个包含两个列的数据框，第一列是细胞标识符（active.ident），第二列是对应的标签（细胞类型）\n\n这行代码首先从`seurat_data`对象中获取当前活动的细胞标识符（`active.ident`），然后将它们转换为数值型，以便与`clustertable`数据框（data frame）的第一列进行匹配。通过`match`函数找到匹配的行，然后从第二列获取对应的标签（`labers`）。\n    \nseurat_data$celltype <- Annotation\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("p",[s._v("还可以改变cluster的顺序 -- "),t("a",{attrs:{href:"https://cloud.tencent.com/developer/article/1841517",target:"_blank",rel:"noopener noreferrer"}},[s._v("对细胞簇重命名"),t("OutboundLink")],1)]),s._v(" "),t("p",[s._v("数值变分类")]),s._v(" "),t("div",{staticClass:"language-text line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('age = as.numeric(pbmc@meta.data$age)\n\nage[age >= 6 &amp; age &lt; 12] &lt;- 2\nage[age == "2"] &lt;- "age 6-12"\n\npbmc$agegroup &lt;- age\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("h3",{attrs:{id:"seurat中的结构"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#seurat中的结构"}},[s._v("#")]),s._v(" Seurat中的结构")]),s._v(" "),t("p",[s._v("levels & Idents & layer & Assay")]),s._v(" "),t("p",[s._v("Ident，身份，也可以理解为每个细胞状态或身份的标识符")]),s._v(" "),t("p",[s._v("levels，层次，表示数据的层次结构")]),s._v(" "),t("p",[s._v("Layer，数据层，不同的数据集")]),s._v(" "),t("p",[s._v("Assay，矩阵，包括基因表达矩阵，免疫表型数据，表观组数据等等")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("levels(x = pbmc_small)\n#> [1] \"B\" \"A\" \"C\"\nlevels(x = pbmc_small) <- c('C', 'A', 'B')\n\n\npbmc_small <- RenameIdents(pbmc_small, '0' = 'A', '2' = 'C')\nlevels(pbmc_small)\n\n\nidentityMapping <- c('0' = 'A', '2' = 'C')\npbmc_small <- RenameIdents(pbmc_small, identityMapping )\n\n\ncells.use <- WhichCells(pbmc_small, idents = '1')\npbmc_small <- SetIdent(pbmc_small, cells = cells.use, value = 'B')\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br")])]),t("p",[s._v("Assay里面的数据")]),s._v(" "),t("ul",[t("li",[s._v("counts，dgCMatrix，未处理的原始稀疏矩阵")]),s._v(" "),t("li",[s._v("data，dgCMatrix，标准化的稀疏矩阵（normalize）")]),s._v(" "),t("li",[s._v("scale.data，matrix，缩放矩阵")]),s._v(" "),t("li",[s._v("key，character，active对象的键，（fetch）")]),s._v(" "),t("li",[s._v("var.features，character，高变基因（VaribleFeatures）")]),s._v(" "),t("li",[s._v("meta.deatures，data.frame，对feature/（gene）的注释")])]),s._v(" "),t("p",[s._v("meta.data；active.ident；reduction；version；commands")]),s._v(" "),t("h3",{attrs:{id:"sctransform"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#sctransform"}},[s._v("#")]),s._v(" SCTransform")]),s._v(" "),t("h3",{attrs:{id:"不常见"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#不常见"}},[s._v("#")]),s._v(" 不常见")]),s._v(" "),t("p",[s._v("UpdateSeuratObject()")]),s._v(" "),t("h2",{attrs:{id:"去除批次"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#去除批次"}},[s._v("#")]),s._v(" 去除批次")]),s._v(" "),t("p",[s._v("单细胞常用的几种整合方法：CCA，SCTransform，Harmony")]),s._v(" "),t("p",[s._v("CCA，Seurat2自带，比较慢，循环着找"),t("code",[s._v("锚点")]),s._v("，再整合；推荐reference-based")]),s._v(" "),t("blockquote",[t("p",[s._v("CCA，Canonical Correlation Analysis，典型关联分析")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("PercentageFeatureSet() → subset() → FindVariableFeatures() →  ormalizeData() → FindVariableFeatures()\n\nFindIntegrationAnchors()\nIntegrateData()\n\nScaleData() → RunPCA() → RunTSNE() → RunUMAP() → FindNeighbors() → FindClusters()\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[s._v("SCTransform，先SCTransform处理，再找锚点，整合")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("PercentageFeatureSet() → subset() → NormalizeData()\n\nSelectIntegrationFeatures()\nPrepSCTIntegration()\nFindIntegrationAnchors()\nIntegrateData()\n\nRunPCA() → RunTSNE() → RunUMAP() → FindNeighbors() → FindClusters()\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("p",[s._v("Harmony，稍快些")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("PercentageFeatureSet() → subset() → FindVariableFeatures() → NormalizeData() → FindVariableFeatures() → ScaleData() → RunPCA() → \n\nRunHarmony()\n\nRunTSNE() → RunUMAP() → FindNeighbors() → FindClusters()\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[s._v("DefaultAssay(pbmc) <- 'RNA'")]),s._v(" "),t("p",[s._v("整合应该按照个体，或者样本编号进行，而不是按照正常与肿瘤整合")]),s._v(" "),t("p",[s._v("CCA，Canonical Correlation Analysis，典型关联分析，Seurat2使用；")]),s._v(" "),t("p",[s._v("CCA + MNN，Mutual Nearest Neighbor，互相最近邻居，Seurat3，4使用")]),s._v(" "),t("p",[s._v("一段很不错的代码")]),s._v(" "),t("p",[t("strong",[s._v("读取和质控")])]),s._v(" "),t("div",{staticClass:"language-R line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-r"}},[t("code",[s._v("\nlibrary"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Seurat"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nlibrary"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("harmony"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nlibrary"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("tidyverse"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nlibrary"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("patchwork"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nrm"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("list "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" ls"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n\nscRNAlist "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<-")]),s._v(" list"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("i "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("length"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("dir"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  counts "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<-")]),s._v(" Read10X"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("data.dir "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" dir"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" \n  scRNAlist"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<-")]),s._v(" CreateSeuratObject"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("counts"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" project"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("samples_name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                                       min.cells"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" min.features "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#给细胞barcode加个前缀，防止合并后barcode重名")]),s._v("\n  scRNAlist"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<-")]),s._v(" RenameCells"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("scRNAlist"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" add.cell.id "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" samples_name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("   \n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#计算线粒体基因比例")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("T"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("    \n    scRNAlist"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"percent.mt"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<-")]),s._v(" PercentageFeatureSet"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("scRNAlist"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" pattern "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"^MT-"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" \n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#计算核糖体基因比例")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("T"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    scRNAlist"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"percent.rb"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<-")]),s._v(" PercentageFeatureSet"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("scRNAlist"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" pattern "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"^RP[SL]"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#计算红细胞基因比例")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("T"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    HB.genes "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<-")]),s._v(" c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"HBA1"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"HBA2"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"HBB"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"HBD"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"HBE1"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"HBG1"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"HBG2"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"HBM"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"HBQ1"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"HBZ"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    HB.genes "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<-")]),s._v(" CaseMatch"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("HB.genes"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" rownames"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("scRNAlist"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    scRNAlist"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"percent.HB"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<-")]),s._v("PercentageFeatureSet"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("scRNAlist"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" features"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("HB.genes"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" \n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n\nnames"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("scRNAlist"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<-")]),s._v(" samples_name\nsystem.time"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("saveRDS"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("scRNAlist"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" file "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"scRNAlist.rds"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br")])]),t("p",[t("strong",[s._v("查看指控效果")]),s._v(" -- 特别是这段")]),s._v(" "),t("div",{staticClass:"language-R line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-r"}},[t("code",[s._v("scRNA "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<-")]),s._v(" merge"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("scRNAlist"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" scRNAlist"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("length"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("scRNAlist"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\ntable"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("scRNA"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("$")]),s._v("orig.ident"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("### 绘制质控小提琴图")]),s._v("\n\ntheme.set2 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" theme"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("axis.title.x"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("element_blank"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置可能用到的主题")]),s._v("\nplot.featrures "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nFeature_RNA"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nCount_RNA"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"percent.mt"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"percent.rb"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"percent.HB"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置绘图元素")]),s._v("\ngroup "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"orig.ident"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 质控前小提琴图")]),s._v("\nplots "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" list"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("i "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" seq_along"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("plot.featrures"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  plots"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" VlnPlot"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("scRNA"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" group.by"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("group"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" pt.size "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                       features "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" plot.featrures"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" theme.set2 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" NoLegend"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nviolin "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<-")]),s._v(" wrap_plots"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("plots "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" plots"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" nrow"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("    \nggsave"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"vlnplot_before_qc.pdf"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" plot "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" violin"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" width "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" height "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("### 设置质控标准")]),s._v("\nminGene"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("500")]),s._v("\nmaxGene"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4000")]),s._v("\nmaxUMI"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15000")]),s._v("\npctMT"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("\npctHB"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("### 数据质控并绘制小提琴图")]),s._v("\nscRNA "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<-")]),s._v(" subset"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("scRNA"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" subset "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" nCount_RNA "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" maxUMI "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v(" nFeature_RNA "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" minGene "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v(" \n                  nFeature_RNA "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" maxGene "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v(" percent.mt "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" pctMT "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v(" percent.HB "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" pctHB"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nplots "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" list"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("i "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" seq_along"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("plot.featrures"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  plots"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" VlnPlot"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("scRNA"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" group.by"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("group"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" pt.size "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                       features "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" plot.featrures"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" theme.set2 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" NoLegend"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nviolin "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<-")]),s._v(" wrap_plots"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("plots "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" plots"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" nrow"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("     \nggsave"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"QC/vlnplot_after_qc.pdf"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" plot "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" violin"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" width "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" height "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br")])]),t("p",[t("img",{attrs:{src:"https://upload-images.jianshu.io/upload_images/15771939-3c11e4ac277fc2a0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1200/format/webp",alt:"质控前的图"}})]),s._v(" "),t("p",[t("img",{attrs:{src:"https://upload-images.jianshu.io/upload_images/15771939-d290cb12412bcf2f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1200/format/webp",alt:"质控后的图"}})]),s._v(" "),t("p",[t("strong",[s._v("降维聚类")]),s._v(" -- 这段代码也很酷")]),s._v(" "),t("div",{staticClass:"language-R line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-r"}},[t("code",[s._v("scRNA "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<-")]),s._v(" NormalizeData"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("scRNA"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token percent-operator operator"}},[s._v("%>%")]),s._v(" FindVariableFeatures"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("nfeatures "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token percent-operator operator"}},[s._v("%>%")]),s._v(" ScaleData"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nscRNA "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<-")]),s._v(" RunPCA"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("scRNA"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" verbose "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" F"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nElbowPlot"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("scRNA"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" ndims "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[t("strong",[s._v("Seurat 锚点整合")])]),s._v(" "),t("div",{staticClass:"language-R line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-r"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 1、读入数据，拆分样本")]),s._v("\nrm"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("list"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ls"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nlibrary"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("future"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#Seurat并行计算的一个包")]),s._v("\noptions"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("future.globals.maxSize "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("^")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#将全局变量上限调至50G（锚点整合很占内存）")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 重新创建没有处理的经过降维等处理的数据 ")]),s._v("\nscRNA "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<-")]),s._v(" readRDS"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"scRNA.rds"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\ncellinfo "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<-")]),s._v(" subset"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("scRNA"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("@")]),s._v("meta.data"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" select "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"orig.ident"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"percent.mt"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"percent.rb"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"percent.HB"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nscRNA "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<-")]),s._v(" CreateSeuratObject"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("scRNA"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("@")]),s._v("assays"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("$")]),s._v("RNA"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("@")]),s._v("counts"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" meta.data "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" cellinfo"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#做锚点整合需要把样本处理成单个的Seurat对象来两两组合；也可以按别的指标（metadata中的）来进行拆分，比如可以按不同的分组来拆分样本，再进行整合。")]),s._v("\nscRNAlist "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<-")]),s._v(" SplitObject"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("scRNA"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" split.by "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"orig.ident"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 2、标准化（锚点整合会把单个样本两两组合，所以需要单独做标准化—")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#SCTransform标准化(⚠️使用log标准化还是SCT标准化差别不大)")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#如果用log标准化，后面FindIntegrationAnchors和IntegrateData函数的normalization.method参数选'LogNormalize'")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#10个对象最好写10个核，没有10个核少写几个也可以。top命令可以查看服务器有几个核，mc.core设置为1就每次处理一个对象。")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mclapply是lapply的多核版本")]),s._v("\nscRNAlist "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<-")]),s._v(" parallel"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("::")]),s._v("mclapply"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("scRNAlist"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" FUN"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("x"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" SCTransform"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("x"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" mc.cores "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" \n\n\t\t\t\t\t\t\t\t\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("、选择用于整合的高变基因\n\t\t\t\t\t\t\t\t\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("### 每个样本的高变基因不完全一样，SelectIntegrationFeatures可以整合这些高变基因，选出3000个")]),s._v("\nscRNA.features "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<-")]),s._v(" SelectIntegrationFeatures"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("scRNAlist"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" nfeatures "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" \nscRNAlist "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<-")]),s._v(" PrepSCTIntegration"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("scRNAlist"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" anchor.features "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" scRNA.features"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" \n\nplan"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"multisession"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" workers "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nscRNA.anchors "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<-")]),s._v(" FindIntegrationAnchors"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("object.list "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" scRNAlist"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#寻找锚点，运行速度非常慢，至少需要1-2小时")]),s._v("\n                                        normalization.method "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"SCT"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#如果前面是log标准化，这里改成LogNormalize")]),s._v("\n                                        anchor.features "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" scRNA.features"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("、整合锚点\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 速度也很慢")]),s._v("\nplan"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"sequential"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#把并行计算改为单核计算")]),s._v("\nscRNA.sct.int "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<-")]),s._v(" IntegrateData"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("scRNA.anchors"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" normalization.method"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"SCT"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#速度慢")]),s._v("\n\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("、降维和可视化\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("### redunction")]),s._v("\nscRNA "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<-")]),s._v(" RunPCA"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("scRNA.sct.int"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" npcs "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" verbose "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("FALSE")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nElbowPlot"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("scRNA"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" ndims"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\npc.num"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("\nscRNA "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<-")]),s._v(" scRNA "),t("span",{pre:!0,attrs:{class:"token percent-operator operator"}},[s._v("%>%")]),s._v(" RunTSNE"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("dims"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("pc.num"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token percent-operator operator"}},[s._v("%>%")]),s._v(" RunUMAP"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("dims"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("pc.num"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("### Visual")]),s._v("\np "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<-")]),s._v(" DimPlot"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("scRNA"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" group.by "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"orig.ident"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nggsave"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"UMAP_Samples_integr.pdf"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" p"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" width "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" height "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\np "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<-")]),s._v(" DimPlot"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("scRNA"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" group.by "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"orig.ident"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" split.by "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"orig.ident"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" ncol "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nggsave"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"UMAP_Samples_Split_integr.pdf"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" p"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" width "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" height "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v("、结果评估\nscRNA "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<-")]),s._v(" FindNeighbors"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("scRNA"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" dims "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token percent-operator operator"}},[s._v("%>%")]),s._v(" FindClusters"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nload"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ref_Hematopoietic.RData"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nDefaultAssay"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("scRNA"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"RNA"')]),s._v("\nscRNA "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<-")]),s._v(" cell_identify"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("scRNA"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" ref_Hematopoietic"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#cell_identify是自己写的函数，ref_Hematopoietic是SingleR中的参考数据集")]),s._v("\np "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<-")]),s._v(" DimPlot"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("scRNA"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" group.by "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"SingleR"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" label "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" T"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nggsave"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"SingleR_Seurat.pdf"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" p"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" width "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" height "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br"),t("span",{staticClass:"line-number"},[s._v("52")]),t("br"),t("span",{staticClass:"line-number"},[s._v("53")]),t("br"),t("span",{staticClass:"line-number"},[s._v("54")]),t("br"),t("span",{staticClass:"line-number"},[s._v("55")]),t("br"),t("span",{staticClass:"line-number"},[s._v("56")]),t("br"),t("span",{staticClass:"line-number"},[s._v("57")]),t("br"),t("span",{staticClass:"line-number"},[s._v("58")]),t("br"),t("span",{staticClass:"line-number"},[s._v("59")]),t("br")])]),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('\n\nHarmony整合\n```R\n1、准备数据\nrm(list = ls())\nscRNA <- readRDS("scRNA.rds")\ncellinfo <- subset(scRNA@meta.data, select = c("orig.ident", "percent.mt", "percent.rb", "percent.HB"))\nscRNA <- CreateSeuratObject(scRNA@assays$RNA@counts, meta.data = cellinfo)\n\n2、数据标准化（和锚点整合不同，不需拆分样本，直接标准化）\nscRNA <- SCTransform(scRNA) # SCT标准化数据\nscRNA <- RunPCA(scRNA, npcs=50, verbose=FALSE) # PCA\n\n3、整合\n# 整合方法1：单个样本间进行整合（推荐，效果更好）\n# group.by.vars, 设置按哪个分组来整合\n# max.iter.harmony设置迭代次数, 默认是10。运行RunHarmony结果会提示在迭代多少次后完成了收敛。\n#⚠️RunHarmony函数中, lambda参数，默认值是1，决定了Harmony整合的力度。lambda值调小，整合力度变大，反之。（只有这个参数影响整合力度，调整范围一般在0.5-2之间）\nscRNA <- RunHarmony(scRNA, group.by.vars="orig.ident", assay.use="SCT", max.iter.harmony = 20) \n\n\n# 整合方法2：按其他分类，如不同分组来校正（实测效果不如方法1）\nif(F){\n  scRNA$batches <- scRNA$orig.ident\n  scRNA$batches <- recode(scRNA$batches, \n                          "HNC01PBMC" = "batch1", \n                          "HNC01TIL" = "batch2",\n                          "HNC10PBMC" = "batch1",\n                          "HNC10TIL" = "batch2",\n                          "HNC20PBMC" = "batch1",\n                          "HNC20TIL" = "batch2",\n                          "PBMC1" = "batch1",\n                          "PBMC2" = "batch1",\n                          "Tonsil1" = "batch3",\n                          "Tonsil2" = "batch3")\n  scRNA2 <- RunHarmony(scRNA, group.by.vars="batches", assay.use="SCT")\n}\n\n4、降维聚类\nElbowPlot(scRNA, ndims = 50)\npc.num=1:30\nscRNA <- RunTSNE(scRNA, reduction="harmony", dims=pc.num) %>% RunUMAP(reduction="harmony", dims=pc.num)\n#scRNA2 <- RunTSNE(scRNA2, reduction="harmony", dims=pc.num) %>% RunUMAP(reduction="harmony", dims=pc.num)\n\np <- DimPlot(scRNA, group.by = "orig.ident") ggsave("UMAP_Samples_harmony.pdf", p, width = 8, height = 6)\np <- DimPlot(scRNA, group.by = "orig.ident", split.by = "orig.ident", ncol = 4)\nggsave("UMAP_Samples_Split_harmony.pdf", p, width = 18, height = 12)\n\n5、评估整合结果\nscRNA <- FindNeighbors(scRNA, dims = 1:30) %>% FindClusters()\nload("ref_Hematopoietic.RData")\nscRNA <- cell_identify(scRNA, ref_Hematopoietic)\np <- DimPlot(scRNA, group.by = "SingleR", label = T)\nggsave("SingleR_Harmony.pdf", p, width = 8, height = 6)\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br"),t("span",{staticClass:"line-number"},[s._v("52")]),t("br"),t("span",{staticClass:"line-number"},[s._v("53")]),t("br"),t("span",{staticClass:"line-number"},[s._v("54")]),t("br"),t("span",{staticClass:"line-number"},[s._v("55")]),t("br")])]),t("p",[s._v("左边是Harmony，右边是CCA方法 -- 锚点整合的有些过分，表达量几乎变成了一样的，没办法做后续的分析"),t("br"),s._v(" "),t("img",{attrs:{src:"https://upload-images.jianshu.io/upload_images/15771939-20fae0f2581d8ea1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1120/format/webp",alt:"Harmony & CCA方法 "}})]),s._v(" "),t("h2",{attrs:{id:"关于harmony"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#关于harmony"}},[s._v("#")]),s._v(" 关于Harmony")]),s._v(" "),t("p",[s._v("Harmony输入的是"),t("code",[s._v("scRNA@reductions$pca")]),s._v("的数据，得出的结果储存在"),t("code",[s._v("scRNA@reductions$harmony")]),s._v("中")]),s._v(" "),t("p",[s._v("许多下游分析是在低维嵌入而不是基因表达上进行的。要使用校正后的Harmony embeddings而不是PC，需要设置"),t("code",[s._v("reduction ='harmony'")])]),s._v(" "),t("blockquote",[t("p",[s._v("下游分析，包括但不限于：RunUMAP，FindNeighBors，FindClusters")])]),s._v(" "),t("p",[s._v("RunHarmony函数中主要参数")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("group.by.vars")]),s._v("，设置按哪个分组来整合")]),s._v(" "),t("li",[t("code",[s._v("max.iter.harmony")]),s._v("，设置迭代次数，默认是10。运行时会提示在迭代多少次后完成了收敛。")]),s._v(" "),t("li",[t("code",[s._v("lambda")]),s._v("，默认值是1，决定了Harmony整合的力度。lambda值调小，整合力度变大（只有这个参数影响整合力度，调整范围一般在0.5-2）")]),s._v(" "),t("li",[t("code",[s._v("theta")]),s._v("，Diversity clustering penalty parameter. Specify for each variable in group.by.vars. "),t("strong",[s._v("Default theta=2")]),s._v(". theta=0 does not encourage any diversity. Larger values of theta result in more diverse clusters. 这个参数我常用默认值，但在不同文献中这个参数往往不同。")]),s._v(" "),t("li",[t("code",[s._v("dims.use")]),s._v("，Which PCA dimensions to use for Harmony. By default, use all.")]),s._v(" "),t("li",[t("code",[s._v("sigma")]),s._v("，Width of soft kmeans clusters. Default sigma=0.1. Sigma scales the distance from a cell to cluster centroids. Larger values of sigma result in cells assigned to more clusters. Smaller values of sigma make soft kmeans cluster approach hard clustering.")])]),s._v(" "),t("p",[s._v("主要原理\n"),t("img",{attrs:{src:"https://upload-images.jianshu.io/upload_images/15771939-dce2141bd95d3013.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1200/format/webp",alt:"Harmony主要原理"}})]),s._v(" "),t("p",[s._v("参考资料：")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://www.jianshu.com/p/acd2138fb449",target:"_blank",rel:"noopener noreferrer"}},[s._v("Seurat的三种单细胞数据整合方法汇总（批次校正）-  简书"),t("OutboundLink")],1)]),s._v(" "),t("p",[t("a",{attrs:{href:"https://www.jianshu.com/p/159df5c4ff21",target:"_blank",rel:"noopener noreferrer"}},[s._v("10x单细胞对象的合并和批次校正--seurat锚点整合+Harmony - 简书"),t("OutboundLink")],1)]),s._v(" "),t("h2",{attrs:{id:"免疫细胞注释"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#免疫细胞注释"}},[s._v("#")]),s._v(" 免疫细胞注释")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://mp.weixin.qq.com/s/0QIx7m5rQC5eD-0MGZSSnQ",target:"_blank",rel:"noopener noreferrer"}},[s._v("公共数据库验证出来了就是对的吗 (qq.com)"),t("OutboundLink")],1)]),s._v(" "),t("p",[s._v("但细胞亚群的生物学命名的四个规则：")]),s._v(" "),t("ul",[t("li",[s._v("已知的生物学亚群")]),s._v(" "),t("li",[s._v("顺序编码加上特异性高表达基因")]),s._v(" "),t("li",[s._v("生物学功能注释")]),s._v(" "),t("li",[s._v("转录因子等基因集特异性亚群（更多的生物学功能数据库）")])]),s._v(" "),t("p",[s._v("一个广为人知的胰腺癌单细胞转录组公共数据库")]),s._v(" "),t("p",[s._v("B细胞继续分亚群："),t("br"),s._v(" "),t("img",{attrs:{src:"https://s2.loli.net/2024/05/31/pQ7IrZzEtcLF8XY.png",alt:"image.png|300"}})]),s._v(" "),t("p",[t("img",{attrs:{src:"https://s2.loli.net/2024/05/31/EjbV2DFWmPNUAxu.png",alt:"image.png|500"}})]),s._v(" "),t("h2",{attrs:{id:"聚类"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#聚类"}},[s._v("#")]),s._v(" 聚类")]),s._v(" "),t("p",[s._v("聚几个类合适，又时候也是需要谨慎考虑的问题，特别是比较新的组织进行单细胞分群的分析过程")]),s._v(" "),t("p",[s._v("ChooseR，一种算法，如有需要，可以详细查查参考一下")])])}),[],!1,null,null,null);t.default=e.exports}}]);